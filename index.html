<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"http:\/\/example.org\/",
  "author": {
    "@type": "Person",
    "name": "Luck TK",
    
    "image": "https://www.gravatar.com/avatar/7ef66f469376a00ef8d953f4220742f6"
    
  },
  "name":"What A Wonderful World！",
  "description":"",
  "url":"http:\/\/example.org\/",
  "keywords":"[]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.89.2 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Luck TK">
<meta name="keywords" content="">
<meta name="description" content="">


<meta property="og:description" content="">
<meta property="og:type" content="website">
<meta property="og:title" content="What A Wonderful World！">
<meta name="twitter:title" content="What A Wonderful World！">
<meta property="og:url" content="http://example.org/">
<meta property="twitter:url" content="http://example.org/">
<meta property="og:site_name" content="What A Wonderful World！">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:locale" content="en">


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@none">


  <meta name="twitter:creator" content="@none">






  <meta property="og:image" content="https://www.gravatar.com/avatar/7ef66f469376a00ef8d953f4220742f6?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/7ef66f469376a00ef8d953f4220742f6?s=640">






    <title>What A Wonderful World！</title>

    <link rel="icon" href="http://example.org/favicon.png">
    
      <link rel="alternate" type="application/rss+xml" title="RSS" href="http://example.org/index.xml">
    

    
      <link rel="publisher" href="https://plus.google.com/&#43;thibaudlepretre">
    

    <link rel="canonical" href="http://example.org/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="http://example.org/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="http://example.org/" aria-label="">What A Wonderful World！</a>
  </div>
  
    
      <a class="header-right-icon open-algolia-search"
         href="http://example.org/#search" aria-label="">
    
    
      <i class="fa fa-lg fa-search"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="http://example.org/#about" aria-label="">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/7ef66f469376a00ef8d953f4220742f6?s=110" alt="" />
        </a>
        <h4 class="sidebar-profile-name">Luck TK</h4>
        
          <h5 class="sidebar-profile-bio">Stay hungry. Stay Foolish  <strong>COOL</strong></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://example.org/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://example.org/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://example.org/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://example.org/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://example.org/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://gitee.com/lucktk/" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/636472/kakawait" target="_blank" rel="noopener" title="Stack Overflow">
    
      <i class="sidebar-button-icon fab fa-lg fa-stack-overflow" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://example.org/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="2"
        class="
               hasCoverMetaIn
               ">
        <section class="postShorten-group main-content-wrap">
          
          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="http://example.org/post/%E7%AC%AC%E4%BA%94%E7%AF%87/" aria-label="">
      
          第五篇
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-04-07T21:22:46&#43;08:00">
        
   7, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="http://example.org/categories/category">category</a>, 
    
      <a class="category-link" href="http://example.org/categories/subcategory">subcategory</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>基于Docker 容器化技术演进，微服务架构也开始广受欢迎。这里会学习使用go-kratos实现微服务~</p>
<p>这篇整体主要介绍一下全图，后续会展开细节~</p>
<h2 id="微服务概念">微服务概念：</h2>
<p>In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery.</p>
<p>简言之，微服务体系结构风格是一种将单个应用程序开发为一套小型服务的方法，每个服务都在自己的流程中运行，并与轻量级机制（通常是HTTP资源API）通信。这些服务是围绕业务能力构建的，可通过完全自动化的部署机制独立部署。</p>
<p>摘自： Martin Fowler 阐述微服务 <a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>
<h2 id="什么是-kratos">什么是 Kratos</h2>
<p>官方介绍：</p>
<p>Kratos 一套轻量级 Go 微服务框架，包含大量微服务相关框架及工具。</p>
<p>摘自： 官网文档：https://go-kratos.dev/docs/</p>
<h2 id="quick-start">Quick Start</h2>
<p>官方介绍的demo例子 <a href="https://go-kratos.dev/docs/getting-started/start">https://go-kratos.dev/docs/getting-started/start</a></p>
<h2 id="初步对kratos从四个维度来学习">初步对kratos从四个维度来学习</h2>
<h3 id="1-使用--构建工具">1. 使用&ndash;构建工具</h3>
<p>构建成功用会生成目录如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  .
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Dockerfile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">LICENSE</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Makefile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">api</span> <span style="color:#75715e">// 下面维护了微服务使用的proto文件以及根据它们所生成的go文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">helloworld</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">v1</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter_grpc</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter_http</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">cmd</span>  <span style="color:#75715e">// 整个项目启动的入口文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">wire</span>.<span style="color:#66d9ef">go</span>  <span style="color:#75715e">// 我们使用wire来维护依赖注入
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">wire_gen</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">configs</span>  <span style="color:#75715e">// 这里通常维护一些本地调试用的样例配置文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">yaml</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">generate</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">mod</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">sum</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">internal</span>  <span style="color:#75715e">// 该服务所有不对外暴露的代码，通常的业务逻辑都在这下面，使用internal避免错误引用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>   <span style="color:#75715e">// 业务逻辑的组装层，类似 DDD 的 domain 层，data 类似 DDD 的 repo，repo 接口在这里定义，使用依赖倒置的原则。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>  <span style="color:#75715e">// 内部使用的config的结构定义，使用proto格式生成
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>  <span style="color:#75715e">// 业务数据访问，包含 cache、db 等封装，实现了 biz 的 repo 接口。我们可能会把 data 与 dao 混淆在一起，data 偏重业务的含义，它所要做的是将领域对象重新拿出来，我们去掉了 DDD 的 infra层。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">server</span>  <span style="color:#75715e">// http和grpc实例的创建和配置
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>  <span style="color:#75715e">// 实现了 api 定义的服务层，类似 DDD 的 application 层，处理 DTO 到 biz 领域实体的转换(DTO -&gt; DO)，同时协同各类 biz 交互，但是不应处理复杂逻辑
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">third_party</span>  <span style="color:#75715e">// api 依赖的第三方proto
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">google</span>
    <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">api</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">annotations</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">httpbody</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>
        <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
        <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>.<span style="color:#a6e22e">proto</span>
</code></pre></div><p>构建项目一个完整的可运行的App
通过模板工具可以生成业务代码（internal），其中包括
DDD（领域驱动设计）presentation-application-domain-infrastructure 相关代码
路由绑定</p>
<h3 id="2-微服务支撑--微服务拓展库学习也使用">2. 微服务支撑&ndash;微服务拓展库学习也使用</h3>
<p>kratos不仅提供了一个框架，还提供灵活支持拓展插件拓展式设计，也一些中间件可供选择。其次也提供微服务中常用的一些组件。</p>
<ul>
<li>logging: 用于请求日志的记录。</li>
<li>metrics: 用于启用metric。</li>
<li>recovery: 用于recovery panic。</li>
<li>tracing: 用于启用trace。</li>
<li>validate: 用于处理参数校验。</li>
<li>metadata: 用于启用元信息传递</li>
<li>auth: 用于提供基于JWT的认证请求</li>
<li>ratelimit: 用于服务端流量限制</li>
<li>circuitbreaker: 用于客户端熔断控制</li>
</ul>
<h3 id="3-运维支持--dockers容器">3 运维支持&ndash;dockers容器</h3>
<p>模板生成的docker-file 可用于直接部署容器环境</p>
<h3 id="4-源码刨析--框架设计思路和中间件基础设施等学习">4 源码刨析&ndash;框架设计思路和中间件、基础设施等学习</h3>
<ul>
<li><a href="examples/helloworld/helloworld">APIs</a>：协议通信以 HTTP/gRPC 为基础，通过 Protobuf 进行定义；</li>
<li><a href="examples/errors/api">Errors</a>：通过 Protobuf 的 Enum 作为错误码定义，以及工具生成判定接口；</li>
<li><a href="examples/metadata">Metadata</a>：在协议通信 HTTP/gRPC 中，通过 Middleware 规范化服务元信息传递；</li>
<li><a href="examples/config">Config</a>：支持多数据源方式，进行配置合并铺平，通过 Atomic 方式支持动态配置；</li>
<li><a href="examples/log">Logger</a>：标准日志接口，可方便集成三方 log 库，并可通过 fluentd 收集日志；</li>
<li><a href="examples/metrics">Metrics</a>：统一指标接口，可以实现各种指标系统，默认集成 Prometheus；</li>
<li><a href="examples/traces">Tracing</a>：遵循 OpenTelemetry 规范定义，以实现微服务链路追踪；</li>
<li><a href="encoding">Encoding</a>：支持 Accept 和 Content-Type 进行自动选择内容编码；</li>
<li><a href="transport/transport.go">Transport</a>：通用的 <a href="examples/http/middlewares">HTTP</a>/<a href="examples/middleware/main.go">gRPC</a> 传输层，实现统一的 <a href="middleware">Middleware</a> 插件支持；</li>
<li><a href="examples/registry">Registry</a>：实现统一注册中心接口，可插件化对接各种注册中心；</li>
<li><a href="examples/validate">Validation</a>: 通过Protobuf统一定义校验规则，并同时适用于HTTP/gRPC服务.</li>
<li><a href="https://github.com/go-kratos/swagger-api/blob/main/examples/helloworld/server/main.go">SwaggerAPI</a>: 通过集成第三方<a href="https://github.com/go-kratos/swagger-api">Swagger插件</a>能够自动生成Swagger API json并启动一个内置的Swaager UI服务.</li>
</ul>
<p>总结</p>
<ul>
<li>使用模板工具减少开发重复部分的代码</li>
<li>使用wire实现了di</li>
<li>传输层抽象transport，支撑拓展</li>
<li>业务层使用DDD，而且可以通过模板生成部分代码，简单易用</li>
<li>对微服务的有比较多支撑库可供借鉴</li>
</ul>
<p>后续介绍</p>
<ul>
<li>使用kratos实现第一个服务</li>
<li>各个库使用与源码学习
未完待续~</li>
</ul>
      
      <p>
        
          <a href="http://example.org/post/%E7%AC%AC%E4%BA%94%E7%AF%87/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="http://example.org/post/%E7%AC%AC%E5%9B%9B%E7%AF%87/" aria-label="">
      
          第四篇
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-04-07T21:22:40&#43;08:00">
        
   7, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="http://example.org/categories/category">category</a>, 
    
      <a class="category-link" href="http://example.org/categories/subcategory">subcategory</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>基于Docker 容器化技术演进，微服务架构也开始广受欢迎。这里会学习使用go-kratos实现微服务~</p>
<p>这篇整体主要介绍一下全图，后续会展开细节~</p>
<h2 id="微服务概念">微服务概念：</h2>
<p>In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery.</p>
<p>简言之，微服务体系结构风格是一种将单个应用程序开发为一套小型服务的方法，每个服务都在自己的流程中运行，并与轻量级机制（通常是HTTP资源API）通信。这些服务是围绕业务能力构建的，可通过完全自动化的部署机制独立部署。</p>
<p>摘自： Martin Fowler 阐述微服务 <a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>
<h2 id="什么是-kratos">什么是 Kratos</h2>
<p>官方介绍：</p>
<p>Kratos 一套轻量级 Go 微服务框架，包含大量微服务相关框架及工具。</p>
<p>摘自： 官网文档：https://go-kratos.dev/docs/</p>
<h2 id="quick-start">Quick Start</h2>
<p>官方介绍的demo例子 <a href="https://go-kratos.dev/docs/getting-started/start">https://go-kratos.dev/docs/getting-started/start</a></p>
<h2 id="初步对kratos从四个维度来学习">初步对kratos从四个维度来学习</h2>
<h3 id="1-使用--构建工具">1. 使用&ndash;构建工具</h3>
<p>构建成功用会生成目录如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  .
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Dockerfile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">LICENSE</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Makefile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">api</span> <span style="color:#75715e">// 下面维护了微服务使用的proto文件以及根据它们所生成的go文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">helloworld</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">v1</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter_grpc</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter_http</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">cmd</span>  <span style="color:#75715e">// 整个项目启动的入口文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">wire</span>.<span style="color:#66d9ef">go</span>  <span style="color:#75715e">// 我们使用wire来维护依赖注入
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">wire_gen</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">configs</span>  <span style="color:#75715e">// 这里通常维护一些本地调试用的样例配置文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">yaml</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">generate</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">mod</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">sum</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">internal</span>  <span style="color:#75715e">// 该服务所有不对外暴露的代码，通常的业务逻辑都在这下面，使用internal避免错误引用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>   <span style="color:#75715e">// 业务逻辑的组装层，类似 DDD 的 domain 层，data 类似 DDD 的 repo，repo 接口在这里定义，使用依赖倒置的原则。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>  <span style="color:#75715e">// 内部使用的config的结构定义，使用proto格式生成
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>  <span style="color:#75715e">// 业务数据访问，包含 cache、db 等封装，实现了 biz 的 repo 接口。我们可能会把 data 与 dao 混淆在一起，data 偏重业务的含义，它所要做的是将领域对象重新拿出来，我们去掉了 DDD 的 infra层。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">server</span>  <span style="color:#75715e">// http和grpc实例的创建和配置
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>  <span style="color:#75715e">// 实现了 api 定义的服务层，类似 DDD 的 application 层，处理 DTO 到 biz 领域实体的转换(DTO -&gt; DO)，同时协同各类 biz 交互，但是不应处理复杂逻辑
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">third_party</span>  <span style="color:#75715e">// api 依赖的第三方proto
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">google</span>
    <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">api</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">annotations</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">httpbody</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>
        <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
        <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>.<span style="color:#a6e22e">proto</span>
</code></pre></div><p>构建项目一个完整的可运行的App
通过模板工具可以生成业务代码（internal），其中包括
DDD（领域驱动设计）presentation-application-domain-infrastructure 相关代码
路由绑定</p>
<h3 id="2-微服务支撑--微服务拓展库学习也使用">2. 微服务支撑&ndash;微服务拓展库学习也使用</h3>
<p>kratos不仅提供了一个框架，还提供灵活支持拓展插件拓展式设计，也一些中间件可供选择。其次也提供微服务中常用的一些组件。</p>
<ul>
<li>logging: 用于请求日志的记录。</li>
<li>metrics: 用于启用metric。</li>
<li>recovery: 用于recovery panic。</li>
<li>tracing: 用于启用trace。</li>
<li>validate: 用于处理参数校验。</li>
<li>metadata: 用于启用元信息传递</li>
<li>auth: 用于提供基于JWT的认证请求</li>
<li>ratelimit: 用于服务端流量限制</li>
<li>circuitbreaker: 用于客户端熔断控制</li>
</ul>
<h3 id="3-运维支持--dockers容器">3 运维支持&ndash;dockers容器</h3>
<p>模板生成的docker-file 可用于直接部署容器环境</p>
<h3 id="4-源码刨析--框架设计思路和中间件基础设施等学习">4 源码刨析&ndash;框架设计思路和中间件、基础设施等学习</h3>
<ul>
<li><a href="examples/helloworld/helloworld">APIs</a>：协议通信以 HTTP/gRPC 为基础，通过 Protobuf 进行定义；</li>
<li><a href="examples/errors/api">Errors</a>：通过 Protobuf 的 Enum 作为错误码定义，以及工具生成判定接口；</li>
<li><a href="examples/metadata">Metadata</a>：在协议通信 HTTP/gRPC 中，通过 Middleware 规范化服务元信息传递；</li>
<li><a href="examples/config">Config</a>：支持多数据源方式，进行配置合并铺平，通过 Atomic 方式支持动态配置；</li>
<li><a href="examples/log">Logger</a>：标准日志接口，可方便集成三方 log 库，并可通过 fluentd 收集日志；</li>
<li><a href="examples/metrics">Metrics</a>：统一指标接口，可以实现各种指标系统，默认集成 Prometheus；</li>
<li><a href="examples/traces">Tracing</a>：遵循 OpenTelemetry 规范定义，以实现微服务链路追踪；</li>
<li><a href="encoding">Encoding</a>：支持 Accept 和 Content-Type 进行自动选择内容编码；</li>
<li><a href="transport/transport.go">Transport</a>：通用的 <a href="examples/http/middlewares">HTTP</a>/<a href="examples/middleware/main.go">gRPC</a> 传输层，实现统一的 <a href="middleware">Middleware</a> 插件支持；</li>
<li><a href="examples/registry">Registry</a>：实现统一注册中心接口，可插件化对接各种注册中心；</li>
<li><a href="examples/validate">Validation</a>: 通过Protobuf统一定义校验规则，并同时适用于HTTP/gRPC服务.</li>
<li><a href="https://github.com/go-kratos/swagger-api/blob/main/examples/helloworld/server/main.go">SwaggerAPI</a>: 通过集成第三方<a href="https://github.com/go-kratos/swagger-api">Swagger插件</a>能够自动生成Swagger API json并启动一个内置的Swaager UI服务.</li>
</ul>
<p>总结</p>
<ul>
<li>使用模板工具减少开发重复部分的代码</li>
<li>使用wire实现了di</li>
<li>传输层抽象transport，支撑拓展</li>
<li>业务层使用DDD，而且可以通过模板生成部分代码，简单易用</li>
<li>对微服务的有比较多支撑库可供借鉴</li>
</ul>
<p>后续介绍</p>
<ul>
<li>使用kratos实现第一个服务</li>
<li>各个库使用与源码学习
未完待续~</li>
</ul>
      
      <p>
        
          <a href="http://example.org/post/%E7%AC%AC%E5%9B%9B%E7%AF%87/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="http://example.org/post/%E7%AC%AC%E4%B8%89%E7%AF%87/" aria-label="">
      
          第三篇
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-04-07T21:22:35&#43;08:00">
        
   7, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="http://example.org/categories/category">category</a>, 
    
      <a class="category-link" href="http://example.org/categories/subcategory">subcategory</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>基于Docker 容器化技术演进，微服务架构也开始广受欢迎。这里会学习使用go-kratos实现微服务~</p>
<p>这篇整体主要介绍一下全图，后续会展开细节~</p>
<h2 id="微服务概念">微服务概念：</h2>
<p>In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery.</p>
<p>简言之，微服务体系结构风格是一种将单个应用程序开发为一套小型服务的方法，每个服务都在自己的流程中运行，并与轻量级机制（通常是HTTP资源API）通信。这些服务是围绕业务能力构建的，可通过完全自动化的部署机制独立部署。</p>
<p>摘自： Martin Fowler 阐述微服务 <a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>
<h2 id="什么是-kratos">什么是 Kratos</h2>
<p>官方介绍：</p>
<p>Kratos 一套轻量级 Go 微服务框架，包含大量微服务相关框架及工具。</p>
<p>摘自： 官网文档：https://go-kratos.dev/docs/</p>
<h2 id="quick-start">Quick Start</h2>
<p>官方介绍的demo例子 <a href="https://go-kratos.dev/docs/getting-started/start">https://go-kratos.dev/docs/getting-started/start</a></p>
<h2 id="初步对kratos从四个维度来学习">初步对kratos从四个维度来学习</h2>
<h3 id="1-使用--构建工具">1. 使用&ndash;构建工具</h3>
<p>构建成功用会生成目录如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  .
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Dockerfile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">LICENSE</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Makefile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">api</span> <span style="color:#75715e">// 下面维护了微服务使用的proto文件以及根据它们所生成的go文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">helloworld</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">v1</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter_grpc</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter_http</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">cmd</span>  <span style="color:#75715e">// 整个项目启动的入口文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">wire</span>.<span style="color:#66d9ef">go</span>  <span style="color:#75715e">// 我们使用wire来维护依赖注入
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">wire_gen</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">configs</span>  <span style="color:#75715e">// 这里通常维护一些本地调试用的样例配置文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">yaml</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">generate</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">mod</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">sum</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">internal</span>  <span style="color:#75715e">// 该服务所有不对外暴露的代码，通常的业务逻辑都在这下面，使用internal避免错误引用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>   <span style="color:#75715e">// 业务逻辑的组装层，类似 DDD 的 domain 层，data 类似 DDD 的 repo，repo 接口在这里定义，使用依赖倒置的原则。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>  <span style="color:#75715e">// 内部使用的config的结构定义，使用proto格式生成
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>  <span style="color:#75715e">// 业务数据访问，包含 cache、db 等封装，实现了 biz 的 repo 接口。我们可能会把 data 与 dao 混淆在一起，data 偏重业务的含义，它所要做的是将领域对象重新拿出来，我们去掉了 DDD 的 infra层。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">server</span>  <span style="color:#75715e">// http和grpc实例的创建和配置
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>  <span style="color:#75715e">// 实现了 api 定义的服务层，类似 DDD 的 application 层，处理 DTO 到 biz 领域实体的转换(DTO -&gt; DO)，同时协同各类 biz 交互，但是不应处理复杂逻辑
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">third_party</span>  <span style="color:#75715e">// api 依赖的第三方proto
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">google</span>
    <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">api</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">annotations</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">httpbody</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>
        <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
        <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>.<span style="color:#a6e22e">proto</span>
</code></pre></div><p>构建项目一个完整的可运行的App
通过模板工具可以生成业务代码（internal），其中包括
DDD（领域驱动设计）presentation-application-domain-infrastructure 相关代码
路由绑定</p>
<h3 id="2-微服务支撑--微服务拓展库学习也使用">2. 微服务支撑&ndash;微服务拓展库学习也使用</h3>
<p>kratos不仅提供了一个框架，还提供灵活支持拓展插件拓展式设计，也一些中间件可供选择。其次也提供微服务中常用的一些组件。</p>
<ul>
<li>logging: 用于请求日志的记录。</li>
<li>metrics: 用于启用metric。</li>
<li>recovery: 用于recovery panic。</li>
<li>tracing: 用于启用trace。</li>
<li>validate: 用于处理参数校验。</li>
<li>metadata: 用于启用元信息传递</li>
<li>auth: 用于提供基于JWT的认证请求</li>
<li>ratelimit: 用于服务端流量限制</li>
<li>circuitbreaker: 用于客户端熔断控制</li>
</ul>
<h3 id="3-运维支持--dockers容器">3 运维支持&ndash;dockers容器</h3>
<p>模板生成的docker-file 可用于直接部署容器环境</p>
<h3 id="4-源码刨析--框架设计思路和中间件基础设施等学习">4 源码刨析&ndash;框架设计思路和中间件、基础设施等学习</h3>
<ul>
<li><a href="examples/helloworld/helloworld">APIs</a>：协议通信以 HTTP/gRPC 为基础，通过 Protobuf 进行定义；</li>
<li><a href="examples/errors/api">Errors</a>：通过 Protobuf 的 Enum 作为错误码定义，以及工具生成判定接口；</li>
<li><a href="examples/metadata">Metadata</a>：在协议通信 HTTP/gRPC 中，通过 Middleware 规范化服务元信息传递；</li>
<li><a href="examples/config">Config</a>：支持多数据源方式，进行配置合并铺平，通过 Atomic 方式支持动态配置；</li>
<li><a href="examples/log">Logger</a>：标准日志接口，可方便集成三方 log 库，并可通过 fluentd 收集日志；</li>
<li><a href="examples/metrics">Metrics</a>：统一指标接口，可以实现各种指标系统，默认集成 Prometheus；</li>
<li><a href="examples/traces">Tracing</a>：遵循 OpenTelemetry 规范定义，以实现微服务链路追踪；</li>
<li><a href="encoding">Encoding</a>：支持 Accept 和 Content-Type 进行自动选择内容编码；</li>
<li><a href="transport/transport.go">Transport</a>：通用的 <a href="examples/http/middlewares">HTTP</a>/<a href="examples/middleware/main.go">gRPC</a> 传输层，实现统一的 <a href="middleware">Middleware</a> 插件支持；</li>
<li><a href="examples/registry">Registry</a>：实现统一注册中心接口，可插件化对接各种注册中心；</li>
<li><a href="examples/validate">Validation</a>: 通过Protobuf统一定义校验规则，并同时适用于HTTP/gRPC服务.</li>
<li><a href="https://github.com/go-kratos/swagger-api/blob/main/examples/helloworld/server/main.go">SwaggerAPI</a>: 通过集成第三方<a href="https://github.com/go-kratos/swagger-api">Swagger插件</a>能够自动生成Swagger API json并启动一个内置的Swaager UI服务.</li>
</ul>
<p>总结</p>
<ul>
<li>使用模板工具减少开发重复部分的代码</li>
<li>使用wire实现了di</li>
<li>传输层抽象transport，支撑拓展</li>
<li>业务层使用DDD，而且可以通过模板生成部分代码，简单易用</li>
<li>对微服务的有比较多支撑库可供借鉴</li>
</ul>
<p>后续介绍</p>
<ul>
<li>使用kratos实现第一个服务</li>
<li>各个库使用与源码学习
未完待续~</li>
</ul>
      
      <p>
        
          <a href="http://example.org/post/%E7%AC%AC%E4%B8%89%E7%AF%87/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="http://example.org/post/%E7%AC%AC%E4%BA%8C%E7%AF%87/" aria-label="">
      
          第二篇
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-04-07T21:21:04&#43;08:00">
        
   7, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="http://example.org/categories/category">category</a>, 
    
      <a class="category-link" href="http://example.org/categories/subcategory">subcategory</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <hr>
<p>title: &ldquo;微服务vsDDD&rdquo;
date: 2022-04-07T21:15:12+08:00
categories:</p>
<ul>
<li>category</li>
<li>subcategory
tags:</li>
<li>tag1</li>
<li>tag2
keywords:</li>
<li>tech
#thumbnailImage: //example.com/image.jpg</li>
</ul>
<hr>
<p>基于Docker 容器化技术演进，微服务架构也开始广受欢迎。这里会学习使用go-kratos实现微服务~</p>
<p>这篇整体主要介绍一下全图，后续会展开细节~</p>
<h2 id="微服务概念">微服务概念：</h2>
<p>In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery.</p>
<p>简言之，微服务体系结构风格是一种将单个应用程序开发为一套小型服务的方法，每个服务都在自己的流程中运行，并与轻量级机制（通常是HTTP资源API）通信。这些服务是围绕业务能力构建的，可通过完全自动化的部署机制独立部署。</p>
<p>摘自： Martin Fowler 阐述微服务 <a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>
<h2 id="什么是-kratos">什么是 Kratos</h2>
<p>官方介绍：</p>
<p>Kratos 一套轻量级 Go 微服务框架，包含大量微服务相关框架及工具。</p>
<p>摘自： 官网文档：https://go-kratos.dev/docs/</p>
<h2 id="quick-start">Quick Start</h2>
<p>官方介绍的demo例子 <a href="https://go-kratos.dev/docs/getting-started/start">https://go-kratos.dev/docs/getting-started/start</a></p>
<h2 id="初步对kratos从四个维度来学习">初步对kratos从四个维度来学习</h2>
<h3 id="1-使用--构建工具">1. 使用&ndash;构建工具</h3>
<p>构建成功用会生成目录如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  .
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Dockerfile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">LICENSE</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Makefile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">api</span> <span style="color:#75715e">// 下面维护了微服务使用的proto文件以及根据它们所生成的go文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">helloworld</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">v1</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter_grpc</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter_http</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">cmd</span>  <span style="color:#75715e">// 整个项目启动的入口文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">wire</span>.<span style="color:#66d9ef">go</span>  <span style="color:#75715e">// 我们使用wire来维护依赖注入
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">wire_gen</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">configs</span>  <span style="color:#75715e">// 这里通常维护一些本地调试用的样例配置文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">yaml</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">generate</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">mod</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">sum</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">internal</span>  <span style="color:#75715e">// 该服务所有不对外暴露的代码，通常的业务逻辑都在这下面，使用internal避免错误引用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>   <span style="color:#75715e">// 业务逻辑的组装层，类似 DDD 的 domain 层，data 类似 DDD 的 repo，repo 接口在这里定义，使用依赖倒置的原则。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>  <span style="color:#75715e">// 内部使用的config的结构定义，使用proto格式生成
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>  <span style="color:#75715e">// 业务数据访问，包含 cache、db 等封装，实现了 biz 的 repo 接口。我们可能会把 data 与 dao 混淆在一起，data 偏重业务的含义，它所要做的是将领域对象重新拿出来，我们去掉了 DDD 的 infra层。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">server</span>  <span style="color:#75715e">// http和grpc实例的创建和配置
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>  <span style="color:#75715e">// 实现了 api 定义的服务层，类似 DDD 的 application 层，处理 DTO 到 biz 领域实体的转换(DTO -&gt; DO)，同时协同各类 biz 交互，但是不应处理复杂逻辑
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">third_party</span>  <span style="color:#75715e">// api 依赖的第三方proto
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">google</span>
    <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">api</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">annotations</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">httpbody</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>
        <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
        <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>.<span style="color:#a6e22e">proto</span>
</code></pre></div><p>构建项目一个完整的可运行的App
通过模板工具可以生成业务代码（internal），其中包括
DDD（领域驱动设计）presentation-application-domain-infrastructure 相关代码
路由绑定</p>
<h3 id="2-微服务支撑--微服务拓展库学习也使用">2. 微服务支撑&ndash;微服务拓展库学习也使用</h3>
<p>kratos不仅提供了一个框架，还提供灵活支持拓展插件拓展式设计，也一些中间件可供选择。其次也提供微服务中常用的一些组件。</p>
<ul>
<li>logging: 用于请求日志的记录。</li>
<li>metrics: 用于启用metric。</li>
<li>recovery: 用于recovery panic。</li>
<li>tracing: 用于启用trace。</li>
<li>validate: 用于处理参数校验。</li>
<li>metadata: 用于启用元信息传递</li>
<li>auth: 用于提供基于JWT的认证请求</li>
<li>ratelimit: 用于服务端流量限制</li>
<li>circuitbreaker: 用于客户端熔断控制</li>
</ul>
<h3 id="3-运维支持--dockers容器">3 运维支持&ndash;dockers容器</h3>
<p>模板生成的docker-file 可用于直接部署容器环境</p>
<h3 id="4-源码刨析--框架设计思路和中间件基础设施等学习">4 源码刨析&ndash;框架设计思路和中间件、基础设施等学习</h3>
<ul>
<li><a href="examples/helloworld/helloworld">APIs</a>：协议通信以 HTTP/gRPC 为基础，通过 Protobuf 进行定义；</li>
<li><a href="examples/errors/api">Errors</a>：通过 Protobuf 的 Enum 作为错误码定义，以及工具生成判定接口；</li>
<li><a href="examples/metadata">Metadata</a>：在协议通信 HTTP/gRPC 中，通过 Middleware 规范化服务元信息传递；</li>
<li><a href="examples/config">Config</a>：支持多数据源方式，进行配置合并铺平，通过 Atomic 方式支持动态配置；</li>
<li><a href="examples/log">Logger</a>：标准日志接口，可方便集成三方 log 库，并可通过 fluentd 收集日志；</li>
<li><a href="examples/metrics">Metrics</a>：统一指标接口，可以实现各种指标系统，默认集成 Prometheus；</li>
<li><a href="examples/traces">Tracing</a>：遵循 OpenTelemetry 规范定义，以实现微服务链路追踪；</li>
<li><a href="encoding">Encoding</a>：支持 Accept 和 Content-Type 进行自动选择内容编码；</li>
<li><a href="transport/transport.go">Transport</a>：通用的 <a href="examples/http/middlewares">HTTP</a>/<a href="examples/middleware/main.go">gRPC</a> 传输层，实现统一的 <a href="middleware">Middleware</a> 插件支持；</li>
<li><a href="examples/registry">Registry</a>：实现统一注册中心接口，可插件化对接各种注册中心；</li>
<li><a href="examples/validate">Validation</a>: 通过Protobuf统一定义校验规则，并同时适用于HTTP/gRPC服务.</li>
<li><a href="https://github.com/go-kratos/swagger-api/blob/main/examples/helloworld/server/main.go">SwaggerAPI</a>: 通过集成第三方<a href="https://github.com/go-kratos/swagger-api">Swagger插件</a>能够自动生成Swagger API json并启动一个内置的Swaager UI服务.</li>
</ul>
<p>总结</p>
<ul>
<li>使用模板工具减少开发重复部分的代码</li>
<li>使用wire实现了di</li>
<li>传输层抽象transport，支撑拓展</li>
<li>业务层使用DDD，而且可以通过模板生成部分代码，简单易用</li>
<li>对微服务的有比较多支撑库可供借鉴</li>
</ul>
<p>后续介绍</p>
<ul>
<li>使用kratos实现第一个服务</li>
<li>各个库使用与源码学习
未完待续~</li>
</ul>
      
      <p>
        
          <a href="http://example.org/post/%E7%AC%AC%E4%BA%8C%E7%AF%87/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="http://example.org/post/%E5%BE%AE%E6%9C%8D%E5%8A%A1vsddd/" aria-label="">
      
          微服务vsDDD
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-04-07T21:15:12&#43;08:00">
        
   7, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="http://example.org/categories/category">category</a>, 
    
      <a class="category-link" href="http://example.org/categories/subcategory">subcategory</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>基于Docker 容器化技术演进，微服务架构也开始广受欢迎。这里会学习使用go-kratos实现微服务~</p>
<p>这篇整体主要介绍一下全图，后续会展开细节~</p>
<h2 id="微服务概念">微服务概念：</h2>
<p>In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery.</p>
<p>简言之，微服务体系结构风格是一种将单个应用程序开发为一套小型服务的方法，每个服务都在自己的流程中运行，并与轻量级机制（通常是HTTP资源API）通信。这些服务是围绕业务能力构建的，可通过完全自动化的部署机制独立部署。</p>
<p>摘自： Martin Fowler 阐述微服务 <a href="https://martinfowler.com/articles/microservices.html">https://martinfowler.com/articles/microservices.html</a></p>
<h2 id="什么是-kratos">什么是 Kratos</h2>
<p>官方介绍：</p>
<p>Kratos 一套轻量级 Go 微服务框架，包含大量微服务相关框架及工具。</p>
<p>摘自： 官网文档：https://go-kratos.dev/docs/</p>
<h2 id="quick-start">Quick Start</h2>
<p>官方介绍的demo例子 <a href="https://go-kratos.dev/docs/getting-started/start">https://go-kratos.dev/docs/getting-started/start</a></p>
<h2 id="初步对kratos从四个维度来学习">初步对kratos从四个维度来学习</h2>
<h3 id="1-使用--构建工具">1. 使用&ndash;构建工具</h3>
<p>构建成功用会生成目录如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  .
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Dockerfile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">LICENSE</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">Makefile</span>  
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">api</span> <span style="color:#75715e">// 下面维护了微服务使用的proto文件以及根据它们所生成的go文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">helloworld</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">v1</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">error_reason</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#a6e22e">swagger</span>.<span style="color:#a6e22e">json</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter_grpc</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>           <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter_http</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">cmd</span>  <span style="color:#75715e">// 整个项目启动的入口文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">wire</span>.<span style="color:#66d9ef">go</span>  <span style="color:#75715e">// 我们使用wire来维护依赖注入
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">wire_gen</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">configs</span>  <span style="color:#75715e">// 这里通常维护一些本地调试用的样例配置文件
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">yaml</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">generate</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">mod</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#66d9ef">go</span>.<span style="color:#a6e22e">sum</span>
<span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">internal</span>  <span style="color:#75715e">// 该服务所有不对外暴露的代码，通常的业务逻辑都在这下面，使用internal避免错误引用
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>   <span style="color:#75715e">// 业务逻辑的组装层，类似 DDD 的 domain 层，data 类似 DDD 的 repo，repo 接口在这里定义，使用依赖倒置的原则。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">biz</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>  <span style="color:#75715e">// 内部使用的config的结构定义，使用proto格式生成
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">pb</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">conf</span>.<span style="color:#a6e22e">proto</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>  <span style="color:#75715e">// 业务数据访问，包含 cache、db 等封装，实现了 biz 的 repo 接口。我们可能会把 data 与 dao 混淆在一起，data 偏重业务的含义，它所要做的是将领域对象重新拿出来，我们去掉了 DDD 的 infra层。
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">data</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">server</span>  <span style="color:#75715e">// http和grpc实例的创建和配置
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">grpc</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">server</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>  <span style="color:#75715e">// 实现了 api 定义的服务层，类似 DDD 的 application 层，处理 DTO 到 biz 领域实体的转换(DTO -&gt; DO)，同时协同各类 biz 交互，但是不应处理复杂逻辑
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">greeter</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">service</span>.<span style="color:#66d9ef">go</span>
<span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">third_party</span>  <span style="color:#75715e">// api 依赖的第三方proto
</span><span style="color:#75715e"></span>    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
    <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">google</span>
    <span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">api</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">annotations</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">│</span>       <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">httpbody</span>.<span style="color:#a6e22e">proto</span>
    <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>
        <span style="color:#960050;background-color:#1e0010">├──</span> <span style="color:#a6e22e">README</span>.<span style="color:#a6e22e">md</span>
        <span style="color:#960050;background-color:#1e0010">└──</span> <span style="color:#a6e22e">validate</span>.<span style="color:#a6e22e">proto</span>
</code></pre></div><p>构建项目一个完整的可运行的App
通过模板工具可以生成业务代码（internal），其中包括
DDD（领域驱动设计）presentation-application-domain-infrastructure 相关代码
路由绑定</p>
<h3 id="2-微服务支撑--微服务拓展库学习也使用">2. 微服务支撑&ndash;微服务拓展库学习也使用</h3>
<p>kratos不仅提供了一个框架，还提供灵活支持拓展插件拓展式设计，也一些中间件可供选择。其次也提供微服务中常用的一些组件。</p>
<ul>
<li>logging: 用于请求日志的记录。</li>
<li>metrics: 用于启用metric。</li>
<li>recovery: 用于recovery panic。</li>
<li>tracing: 用于启用trace。</li>
<li>validate: 用于处理参数校验。</li>
<li>metadata: 用于启用元信息传递</li>
<li>auth: 用于提供基于JWT的认证请求</li>
<li>ratelimit: 用于服务端流量限制</li>
<li>circuitbreaker: 用于客户端熔断控制</li>
</ul>
<h3 id="3-运维支持--dockers容器">3 运维支持&ndash;dockers容器</h3>
<p>模板生成的docker-file 可用于直接部署容器环境</p>
<h3 id="4-源码刨析--框架设计思路和中间件基础设施等学习">4 源码刨析&ndash;框架设计思路和中间件、基础设施等学习</h3>
<ul>
<li><a href="examples/helloworld/helloworld">APIs</a>：协议通信以 HTTP/gRPC 为基础，通过 Protobuf 进行定义；</li>
<li><a href="examples/errors/api">Errors</a>：通过 Protobuf 的 Enum 作为错误码定义，以及工具生成判定接口；</li>
<li><a href="examples/metadata">Metadata</a>：在协议通信 HTTP/gRPC 中，通过 Middleware 规范化服务元信息传递；</li>
<li><a href="examples/config">Config</a>：支持多数据源方式，进行配置合并铺平，通过 Atomic 方式支持动态配置；</li>
<li><a href="examples/log">Logger</a>：标准日志接口，可方便集成三方 log 库，并可通过 fluentd 收集日志；</li>
<li><a href="examples/metrics">Metrics</a>：统一指标接口，可以实现各种指标系统，默认集成 Prometheus；</li>
<li><a href="examples/traces">Tracing</a>：遵循 OpenTelemetry 规范定义，以实现微服务链路追踪；</li>
<li><a href="encoding">Encoding</a>：支持 Accept 和 Content-Type 进行自动选择内容编码；</li>
<li><a href="transport/transport.go">Transport</a>：通用的 <a href="examples/http/middlewares">HTTP</a>/<a href="examples/middleware/main.go">gRPC</a> 传输层，实现统一的 <a href="middleware">Middleware</a> 插件支持；</li>
<li><a href="examples/registry">Registry</a>：实现统一注册中心接口，可插件化对接各种注册中心；</li>
<li><a href="examples/validate">Validation</a>: 通过Protobuf统一定义校验规则，并同时适用于HTTP/gRPC服务.</li>
<li><a href="https://github.com/go-kratos/swagger-api/blob/main/examples/helloworld/server/main.go">SwaggerAPI</a>: 通过集成第三方<a href="https://github.com/go-kratos/swagger-api">Swagger插件</a>能够自动生成Swagger API json并启动一个内置的Swaager UI服务.</li>
</ul>
<p>总结</p>
<ul>
<li>使用模板工具减少开发重复部分的代码</li>
<li>使用wire实现了di</li>
<li>传输层抽象transport，支撑拓展</li>
<li>业务层使用DDD，而且可以通过模板生成部分代码，简单易用</li>
<li>对微服务的有比较多支撑库可供借鉴</li>
</ul>
<p>后续介绍</p>
<ul>
<li>使用kratos实现第一个服务</li>
<li>各个库使用与源码学习
未完待续~</li>
</ul>
      
      <p>
        
          <a href="http://example.org/post/%E5%BE%AE%E6%9C%8D%E5%8A%A1vsddd/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
          

        </section>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Luck TK. 
  </span>
</footer>

      </div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/7ef66f469376a00ef8d953f4220742f6?s=110" alt="" />
    
    <h4 id="about-card-name">Luck TK</h4>
    
      <div id="about-card-bio">Stay hungry. Stay Foolish  <strong>COOL</strong></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Go backend developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        China
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('http://example.org/images/cover.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="http://example.org/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

