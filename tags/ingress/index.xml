<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ingress on jefffff&#39;s Blog</title>
    <link>https://luckytking.github.io/tags/ingress/</link>
    <description>Recent content in ingress on jefffff&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sun, 20 Nov 2022 15:31:51 +0800</lastBuildDate><atom:link href="https://luckytking.github.io/tags/ingress/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Ingress与IngressController</title>
      <link>https://luckytking.github.io/2022/11/ingress%E4%B8%8Eingresscontroller/</link>
      <pubDate>Sun, 20 Nov 2022 15:31:51 +0800</pubDate>
      
      <guid>https://luckytking.github.io/2022/11/ingress%E4%B8%8Eingresscontroller/</guid>
      <description>&lt;p&gt;本文主要学习记录Kubernetes集群暴露服务的方式: Ingress。&lt;/p&gt;
&lt;h3 id=&#34;简介&#34;&gt;简介&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Ingress 是对集群中服务的外部访问进行管理的 API 对象，典型的访问方式是 HTTP。Ingress 可以提供负载均衡、SSL 终结和基于名称的虚拟托管。&lt;/p&gt;
&lt;p&gt;IngressController  为了让 Ingress 资源工作，集群必须有一个正在运行的 Ingress 控制器。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://luckytking.github.io/images/ingress_layout.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;上图清晰标识出了Ingress的流量走向，其中：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ingress基于DNS名称（host）或URL路径把请求转发⾄指定的Service资源的规则。它仅是⼀组路由规则的集合。&lt;/li&gt;
&lt;li&gt;Ingress控制器是真正实现“流量穿透”，可以由具有反向代理（HTTP/HTTPS）功能的服务程序实现 , 然后根据这些规则的匹配机制路由请求流量&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ingress-资源声明&#34;&gt;Ingress 资源声明&lt;/h3&gt;
&lt;p&gt;Ingress是Kubernetes API的标准资源类型之⼀ ,一个最小Ingress例子：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;networking.k8s.io/v1&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Ingress&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
  &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;minimal-ingress&lt;/span&gt;
  &lt;span style=&#34;color:#f92672&#34;&gt;annotations&lt;/span&gt;:
    &lt;span style=&#34;color:#f92672&#34;&gt;nginx.ingress.kubernetes.io/rewrite-target&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;/&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
  &lt;span style=&#34;color:#f92672&#34;&gt;ingressClassName&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;nginx-example&lt;/span&gt;
  &lt;span style=&#34;color:#f92672&#34;&gt;rules&lt;/span&gt;:
  - &lt;span style=&#34;color:#f92672&#34;&gt;http&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;paths&lt;/span&gt;:
      - &lt;span style=&#34;color:#f92672&#34;&gt;path&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;/testpath&lt;/span&gt;
        &lt;span style=&#34;color:#f92672&#34;&gt;pathType&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Prefix&lt;/span&gt;
        &lt;span style=&#34;color:#f92672&#34;&gt;backend&lt;/span&gt;:
          &lt;span style=&#34;color:#f92672&#34;&gt;service&lt;/span&gt;:
            &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;test&lt;/span&gt;
            &lt;span style=&#34;color:#f92672&#34;&gt;port&lt;/span&gt;:
              &lt;span style=&#34;color:#f92672&#34;&gt;number&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;其中:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ingress 需要指定 apiVersion、kind、 metadata和 spec 字段。&lt;/li&gt;
&lt;li&gt;Ingress 对象的命名必须是合法的 DNS 子域名名称。&lt;/li&gt;
&lt;li&gt;Ingress annotations 来配置一些选项,  ⽤于识别其所属的Ingress控制器的类别。&lt;/li&gt;
&lt;li&gt;Ingress rules 提供了配置负载均衡器或者代理服务器所需的所有信息。 最重要的是，其中包含与所有传入请求匹配的规则列表。 Ingress 资源仅支持用于转发 HTTP(S) 流量的规则。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;更多参考： &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/&#34;&gt;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;ingress-controller&#34;&gt;Ingress Controller&lt;/h3&gt;
&lt;p&gt;Ingress控制器可以由任何具有反向代理（HTTP/HTTPS）功能的服务程序实现，目前支持和维护 AWS、 GCE 和 Nginx Ingress 控制器。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nginx Ingress 作为反向代理和负载均衡器。&lt;/li&gt;
&lt;li&gt;Apache APISIX Ingress 控制器 是一个基于 Apache APISIX 网关 的 Ingress 控制器。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;更多参考：https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/&lt;/p&gt;
&lt;h3 id=&#34;安装-ingress-nginx&#34;&gt;安装 Ingress Nginx&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.0.0/deploy/static/provider/cloud/deploy.yaml  -O ingress-nginx-deploy.yaml

kubectl apply -f  ingress-nginx-deploy.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;观测是否成功：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl get pods -n ingress-nginx --watch
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果成功的话，查看namespace下所有的资源信息&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;root@master:/home/master# kubectl get all -n ingress-nginx
NAME                                            READY   STATUS    RESTARTS   AGE
pod/ingress-nginx-controller-123456   1/1     Running   0          1h

NAME                                         TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)                      AGE
service/ingress-nginx-controller             LoadBalancer   10.104.182.98    192.168.1.100   80:31666/TCP,443:31888/TCP   1d
service/ingress-nginx-controller-admission   ClusterIP      10.111.228.99   &amp;lt;none&amp;gt;         443/TCP                      1d

NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/ingress-nginx-controller   1/1     1            1           1d

NAME                                                  DESIRED   CURRENT   READY   AGE
replicaset.apps/ingress-nginx-controller-123456   1         1         1      1d

NAME                                       COMPLETIONS   DURATION   AGE
job.batch/ingress-nginx-admission-create   1/1           1s         1d
job.batch/ingress-nginx-admission-patch    1/1           2s         1d
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;使用ingress-发布-tomcat&#34;&gt;使用Ingress 发布 Tomcat&lt;/h3&gt;
&lt;p&gt;部署Tomcat Service&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建deployment&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    kubectl create deployment web --image=tomcat:8.0.50-jre8-alpine
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;将 Deployment 暴露出来&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;kubectl expose deployment web --type=NodePort --port=8080

&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;将 Deployment 暴露出来&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;root@master:/home/master# kubectl get service web
    NAME   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    web    NodePort   10.100.183.22   &amp;lt;none&amp;gt;        8080:32562/TCP   30s
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;验证nodeport 是否正常访问 tomcat ，浏览器访问  http://matster_ip:32562
&lt;img src=&#34;https://luckytking.github.io/images/ingress_tomcat.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;创建 ingress&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt; &lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;networking.k8s.io/v1&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Ingress&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ingressfoo&lt;/span&gt;
      &lt;span style=&#34;color:#f92672&#34;&gt;annotations&lt;/span&gt;:
        &lt;span style=&#34;color:#f92672&#34;&gt;kubernetes.io/ingress.class&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;
      &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;default&lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
      &lt;span style=&#34;color:#f92672&#34;&gt;rules&lt;/span&gt;:
      - &lt;span style=&#34;color:#f92672&#34;&gt;host&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ingressfoo.io&lt;/span&gt;
        &lt;span style=&#34;color:#f92672&#34;&gt;http&lt;/span&gt;:
          &lt;span style=&#34;color:#f92672&#34;&gt;paths&lt;/span&gt;:
          - &lt;span style=&#34;color:#f92672&#34;&gt;backend&lt;/span&gt;:
              &lt;span style=&#34;color:#f92672&#34;&gt;service&lt;/span&gt;:
                &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;web&lt;/span&gt;
                &lt;span style=&#34;color:#f92672&#34;&gt;port&lt;/span&gt;:
                  &lt;span style=&#34;color:#f92672&#34;&gt;number&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;8080&lt;/span&gt;
            &lt;span style=&#34;color:#f92672&#34;&gt;path&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;/bar&lt;/span&gt;
            &lt;span style=&#34;color:#f92672&#34;&gt;pathType&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Prefix&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;查看ingress是否创建成功&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;root@master:/home/master# kubectl get ingress
NAME         CLASS    HOSTS                     ADDRESS        PORTS   AGE
ingressfoo   &amp;lt;none&amp;gt;   ingressfoo.io   192.168.1.100   80      1h
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;说明Ingress创建成功，修改hosts ：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ingressfoo.io 192.168.1.100&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;验证访问 ingressfoo.io/bar&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://luckytking.github.io/images/ingress_tomcat2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;success&lt;/p&gt;
&lt;h3 id=&#34;参考&#34;&gt;参考&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Ingress  介绍 &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/&#34;&gt;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;IngressController 介绍  &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/&#34;&gt;https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/apache/apisix-ingress-controller&#34;&gt;https://github.com/apache/apisix-ingress-controller&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;NGINX Ingress 控制器配置 Ingress &lt;a href=&#34;https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%90%AF%E7%94%A8-ingress-%E6%8E%A7%E5%88%B6%E5%99%A8&#34;&gt;https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%90%AF%E7%94%A8-ingress-%E6%8E%A7%E5%88%B6%E5%99%A8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;在K8S上的Web服务该怎么做域名解析 &lt;a href=&#34;https://mp.weixin.qq.com/s/ZU61NIMxh_UOo-chNvkPXA&#34;&gt;https://mp.weixin.qq.com/s/ZU61NIMxh_UOo-chNvkPXA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;《Kubernetes进阶实战-第2版》  https://item.jd.com/13140598.html&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
  </channel>
</rss>
