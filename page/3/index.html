<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <script type="application/ld+json">

{  
  "@context":"http://schema.org",
  "@type":"Website",
  "@id":"https:\/\/luckytking.github.io\/",
  "author": {
    "@type": "Person",
    "name": "jefffff",
    
    "image": "https://luckytking.github.io/images/tk.jpg"
    
  },
  "name":"jefffff\u0027s Blog",
  "description":"",
  "url":"https:\/\/luckytking.github.io\/",
  "keywords":"[]"
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.89.2 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="jefffff">
<meta name="keywords" content="">
<meta name="description" content="">


<meta property="og:description" content="">
<meta property="og:type" content="website">
<meta property="og:title" content="jefffff&#39;s Blog">
<meta name="twitter:title" content="jefffff&#39;s Blog">
<meta property="og:url" content="https://luckytking.github.io/">
<meta property="twitter:url" content="https://luckytking.github.io/">
<meta property="og:site_name" content="jefffff&#39;s Blog">
<meta property="og:description" content="">
<meta name="twitter:description" content="">
<meta property="og:locale" content="en">


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@none">


  <meta name="twitter:creator" content="@none">






  <meta property="og:image" content="https://luckytking.github.io/images/tk.jpg">
  <meta property="twitter:image" content="https://luckytking.github.io/images/tk.jpg">






    <title>jefffff&#39;s Blog</title>

    <link rel="icon" href="https://luckytking.github.io/favicon.jpg">
    
      <link rel="alternate" type="application/rss+xml" title="RSS" href="https://luckytking.github.io/index.xml">
    

    
      <link rel="publisher" href="https://plus.google.com/&#43;thibaudlepretre">
    

    <link rel="canonical" href="https://luckytking.github.io/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://luckytking.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://luckytking.github.io/" aria-label="">jefffff&#39;s Blog</a>
  </div>
  
    
      <a class="header-right-icon open-algolia-search"
         href="https://luckytking.github.io/#search" aria-label="">
    
    
      <i class="fa fa-lg fa-search"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://luckytking.github.io/#about" aria-label="">
          <img class="sidebar-profile-picture" src="https://luckytking.github.io/images/tk.jpg" alt="" />
        </a>
        <h4 class="sidebar-profile-name">jefffff</h4>
        
          <h5 class="sidebar-profile-bio">Stay hungry. Stay Foolish  <strong>COOL</strong></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luckytking.github.io/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luckytking.github.io/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luckytking.github.io/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luckytking.github.io/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luckytking.github.io/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/luckytking" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luckytking.github.io/index.xml" title="RSS">
    
      <i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="2"
        class="
               hasCoverMetaIn
               ">
        <section class="postShorten-group main-content-wrap">
          
          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2023/02/gorilla-mux%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E5%92%8C%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD/" aria-label="">
      
          Gorilla Muxçš„åŸºç¡€ä½¿ç”¨å’Œå¸¸ç”¨åŠŸèƒ½
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-02-04T21:28:28&#43;08:00">
        
   4, 2023

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/go">go</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>gorilla/muxä¸€ä¸ªè‰¯å¥½è´¨é‡çš„Httpè·¯ç”±å™¨å’ŒUrlåŒ¹é…å™¨ï¼Œå¾ˆå¥½è¡¥å……net/httpåŒ…HTTPåè®®å¤æ‚çš„è·¯ç”±è¯·æ±‚ã€‚æœ¬æ–‡ä¸»è¦è®°å½•gorillaçš„åŸºç¡€ä½¿ç”¨ã€å’Œå¸¸ç”¨åŠŸèƒ½æå–ç½‘å€å‚æ•°ã€è·¯å¾„å‰ç¼€å’Œå­è·¯ç”±å™¨ã€ä¸­é—´ä»¶ã€‚</p>
<h3 id="åŸºç¡€ä½¿ç”¨">åŸºç¡€ä½¿ç”¨</h3>
<h4 id="å®‰è£…">å®‰è£…</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">go get -u github.com/gorilla/mux
</code></pre></div><h4 id="åˆ›å»ºè·¯ç”±å™¨">åˆ›å»ºè·¯ç”±å™¨</h4>
<p>é€šè¿‡ mux.NewRouter() åˆ›å»ºè·¯ç”±å™¨ï¼Œç¨åå°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™æœåŠ¡å™¨ã€‚å®ƒå°†æ¥æ”¶æ‰€æœ‰ HTTP è¿æ¥å¹¶å°†å…¶ä¼ é€’ç»™æ‚¨å°†åœ¨å…¶ä¸Šæ³¨å†Œçš„è¯·æ±‚å¤„ç†ç¨‹åºã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/gorilla/mux&#34;</span>
	<span style="color:#e6db74">&#34;net/http&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#75715e">//åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯ç”±å™¨
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">NewRouter</span>()

	<span style="color:#75715e">//ç­‰æ•ˆäºhttp.HandleFunc()å·¥ä½œåŸç†
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/foo&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;foo&#34;</span>)
	})
	<span style="color:#75715e">//ç­‰æ•ˆäºhttp.Handler()å·¥ä½œåŸç†
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">handler</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Handler</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandlerFunc</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;bar&#34;</span>)
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;bar&#34;</span>)
	}))
	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Handle</span>(<span style="color:#e6db74">&#34;/foo&#34;</span>, <span style="color:#a6e22e">handler</span>)
    <span style="color:#75715e">//ä½œä¸ºæœåŠ¡å‚æ•°ä¼ å…¥
</span><span style="color:#75715e"></span>   <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;:80&#34;</span>, <span style="color:#a6e22e">r</span>) 
  }  
  <span style="color:#75715e">//è¯·æ±‚http://yourip:80/foo  http://yourip:80/bar 
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//output
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//foo bar 
</span></code></pre></div><h3 id="ç½‘å€å‚æ•°">ç½‘å€å‚æ•°</h3>
<p>gorilla/muxçš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯ï¼šä»urlä¸­æå‰å‚æ•°ï¼Œä¾‹å¦‚ä¸€ä¸ªrestful apiï¼š/country/{country}/province/{province} ï¼Œä»requestå‚æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">oneHander</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
		<span style="color:#a6e22e">vars</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">Vars</span>(<span style="color:#a6e22e">r</span>)
		<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">vars</span>[<span style="color:#e6db74">&#34;country&#34;</span>]
		<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">vars</span>[<span style="color:#e6db74">&#34;province&#34;</span>]
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Welcome to  %s %s\n&#34;</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">p</span>)
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;Welcome to  %s %s\n&#34;</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">p</span>)
	}
	<span style="color:#75715e">//URL ä¸­æå–æ®µ/å˜é‡
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/country/{country}/province/{province}&#34;</span>, <span style="color:#a6e22e">oneHander</span>)
    <span style="color:#75715e">//è¯·æ±‚ http://yourip/country/china/province/fujian   
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//output
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//Welcome to china fujian
</span></code></pre></div><h3 id="è·¯å¾„å‰ç¼€å’Œå­è·¯ç”±å™¨">è·¯å¾„å‰ç¼€å’Œå­è·¯ç”±å™¨</h3>
<p>æœ‰äº›åœºæ™¯å°†è¯·æ±‚å¤„ç†ç¨‹åºé™åˆ¶ä¸ºç‰¹å®šè·¯å¾„å‰ç¼€ï¼Œæ¯”å¦‚apiã€adminã€cheat æˆ– v1ã€v2ã€v3 æˆ– beta ã€prodã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">	<span style="color:#a6e22e">allHanler</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
		<span style="color:#a6e22e">vars</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">Vars</span>(<span style="color:#a6e22e">r</span>)
		<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">vars</span>[<span style="color:#e6db74">&#34;country&#34;</span>]
		<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">vars</span>[<span style="color:#e6db74">&#34;province&#34;</span>]
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;Welcome to %s %s\n&#34;</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">p</span>)
	}
	<span style="color:#75715e">//è·¯å¾„å‰ç¼€å’Œå­è·¯ç”±å™¨
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">countryRouter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">PathPrefix</span>(<span style="color:#e6db74">&#34;/country&#34;</span>).<span style="color:#a6e22e">Subrouter</span>()
	<span style="color:#a6e22e">countryRouter</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">allHanler</span>)
	<span style="color:#a6e22e">countryRouter</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/{province}&#34;</span>, <span style="color:#a6e22e">oneHander</span>)
    <span style="color:#75715e">//è¯·æ±‚ http://yourip/country/china  
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//output
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//Welcome to china
</span></code></pre></div><h3 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h3>
<p>Mux æ”¯æŒå‘Routeræ·»åŠ ä¸­é—´ä»¶ï¼Œå¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œä¸­é—´ä»¶å°†æŒ‰ç…§æ·»åŠ çš„é¡ºåºæ‰§è¡Œï¼ŒåŒ…æ‹¬å…¶å­è·¯ç”±å™¨ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Middleware1</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">Router</span>) <span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">MiddlewareFunc</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">next</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Handler</span>) <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Handler</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandlerFunc</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">req</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;do something before handler&#34;</span>)
			<span style="color:#a6e22e">next</span>.<span style="color:#a6e22e">ServeHTTP</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">req</span>)
			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;do something after handler&#34;</span>)
		})
	}
}

	<span style="color:#75715e">//ä¸­é—´ä»¶
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">middleware1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Middleware1</span>(<span style="color:#a6e22e">r</span>)
	<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Use</span>([]<span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">MiddlewareFunc</span>{<span style="color:#a6e22e">middleware1</span>}<span style="color:#f92672">...</span>)
    <span style="color:#75715e">//è¯·æ±‚ http://yourip/country/china/province/fujian   
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//output
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//do something before handler
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//Welcome to  china fujian
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//do something after handler
</span></code></pre></div><h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li><a href="https://github.com/gorilla/mux">https://github.com/gorilla/mux</a></li>
<li><a href="https://gowebexamples.com/routes-using-gorilla-mux/">https://gowebexamples.com/routes-using-gorilla-mux/</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2023/02/gorilla-mux%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E5%92%8C%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2023/01/go%E5%9F%BA%E4%BA%8Eredis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" aria-label="">
      
          GoåŸºäºRediså®ç°åˆ†å¸ƒå¼é”
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-01-08T16:00:30&#43;08:00">
        
   8, 2023

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/go">go</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <h3 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h3>
<p>éšç€åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¿«é€Ÿå‘å±•å’Œå¹¿æ³›åº”ç”¨ï¼Œå¦‚ä½•å¤„ç†å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®åœºæ™¯å‘¢ï¼Ÿå³åˆ†å¸ƒå¼é”ï¼Œå¸¸è§é‡‡ç”¨æœ‰å¼€æºçš„ MySQLï¼ŒRedisï¼ŒZooKeeperï¼ŒEtcd ç­‰ä¸‰æ–¹ç»„ä»¶æ¥å®ç°ã€‚ä»Šå¤©ä¸»è¦ä»‹ç»GolangåŸºäºRediså®ç°åˆ†å¸ƒå¼äº’æ–¥é”ã€‚</p>
<h3 id="åˆ†å¸ƒå¼é”ç‰¹æ€§">åˆ†å¸ƒå¼é”ç‰¹æ€§</h3>
<p>é‚£ä¹ˆåˆ†å¸ƒå¼é”éœ€è¦å¤„ç†å“ªäº›é—®é¢˜åœºæ™¯å‘¢ï¼Œæˆ–è€…è¯´ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ
è¿™æ˜¯redis.ioçš„åŸæ–‡ï¼š</p>
<blockquote>
<p>å®‰å…¨å’Œæ´»åŠ›ä¿è¯ï¼š</p>
<ol>
<li>å®‰å…¨ç‰¹æ€§ï¼šäº’æ–¥ã€‚åœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥æŒæœ‰ä¸€æŠŠé”ã€‚</li>
<li>æ´»æ€§å±æ€§ Aï¼šæ— æ­»é”ã€‚æœ€ç»ˆæ€»æ˜¯æœ‰å¯èƒ½è·å¾—é”ï¼Œå³ä½¿é”å®šèµ„æºçš„å®¢æˆ·ç«¯å´©æºƒæˆ–åˆ†åŒºã€‚</li>
<li>æ´»æ€§å±æ€§ Bï¼šå®¹é”™æ€§ã€‚åªè¦å¤§å¤šæ•° Redis èŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥è·å–å’Œé‡Šæ”¾é”</li>
</ol>
</blockquote>
<p>ç»“åˆå®é™…åœºæ™¯ï¼Œç¿»è¯‘ä¸€ä¸‹ï¼š</p>
<ol>
<li>äº’æ–¥æ€§ã€‚é”çš„åŸºç¡€ç‰¹æ€§ï¼Œåªèƒ½è¢«ç¬¬ä¸€ä¸ªæŒæœ‰è€…æŒæœ‰ï¼›</li>
<li>é˜²æ­»é”ã€‚åœ¨æŒæœ‰æ–¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè®¾ç½®é”çš„è¶…æ—¶é‡Šæ”¾æœºåˆ¶ï¼Œè§„é¿æ­»é”é£é™©</li>
<li>é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€‚</li>
</ol>
<h3 id="go-redsyn">go-redsyn</h3>
<p>Redsync ä¸º Go æä¾›äº†åŸºäº Redis çš„åˆ†å¸ƒå¼äº’æ–¥é”å®ç°
å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ go get github.com/go-redsync/redsync/v4
</code></pre></div><p>ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#a6e22e">goredislib</span> <span style="color:#e6db74">&#34;github.com/go-redis/redis/v8&#34;</span>
	<span style="color:#e6db74">&#34;github.com/go-redsync/redsync/v4&#34;</span>
	<span style="color:#e6db74">&#34;github.com/go-redsync/redsync/v4/redis/goredis/v8&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#75715e">//ä½¿ç”¨go-redis(æˆ–redigo)åˆ›å»ºä¸€ä¸ªæ± ï¼Œè¯¥æ± æ˜¯redisync will
</span><span style="color:#75715e">//åœ¨ä¸Redisé€šä¿¡æ—¶ä½¿ç”¨è¿™ä¹Ÿå¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªæ± å­
</span><span style="color:#75715e">//å®ç°&#39; redis. properties &#39;æ± çš„æ¥å£ã€‚
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">goredislib</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">goredislib</span>.<span style="color:#a6e22e">Options</span>{
		<span style="color:#a6e22e">Addr</span>: <span style="color:#e6db74">&#34;localhost:6379&#34;</span>,
	})
    
    <span style="color:#75715e">//redisé›†ç¾¤
</span><span style="color:#75715e">//clientÂ :=Â goredislib.NewClusterClient(&amp;goredislib.ClusterOptions{Â Â Â Â Â Â Â Â //Addr:Â []string{&#34;localhost:6379&#34;},Â Â Â Â })
</span><span style="color:#75715e"></span>
	<span style="color:#a6e22e">pool</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">goredis</span>.<span style="color:#a6e22e">NewPool</span>(<span style="color:#a6e22e">client</span>) <span style="color:#75715e">// or, pool := redigo.NewPool(...)
</span><span style="color:#75715e"></span>
	<span style="color:#75715e">//åˆ›å»ºredisyncå®ä¾‹ï¼Œç”¨äºè·å¾—äº’æ–¥é”ã€‚
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">rs</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">redsync</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">pool</span>)

	<span style="color:#75715e">//ä¸ºæ‰€æœ‰éœ€è¦äº’æ–¥å¯¹è±¡çš„å®ä¾‹ä½¿ç”¨ç›¸åŒçš„åç§°æ¥è·å–ä¸€ä¸ªæ–°çš„äº’æ–¥å¯¹è±¡
</span><span style="color:#75715e">//ç›¸åŒçš„é”ã€‚
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">mutexname</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;my-global-mutex&#34;</span>
	<span style="color:#a6e22e">mutex</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">NewMutex</span>(<span style="color:#a6e22e">mutexname</span>)

	<span style="color:#75715e">//è·å–äº’æ–¥é”åœ¨è¿™ä¸ªæˆåŠŸä¹‹åï¼Œæ²¡æœ‰å…¶ä»–äºº
</span><span style="color:#75715e">//å¯ä»¥è·å¾—ç›¸åŒçš„é”(ç›¸åŒçš„äº’æ–¥é”å)ï¼Œç›´åˆ°æˆ‘ä»¬è§£é”å®ƒã€‚
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#75715e">//åšä½ éœ€è¦é”çš„å·¥ä½œã€‚
</span><span style="color:#75715e"></span>    
<span style="color:#75715e">//é‡Šæ”¾é”ï¼Œä»¥ä¾¿å…¶ä»–è¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥è·å¾—é”ã€‚
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">ok</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Unlock</span>(); !<span style="color:#a6e22e">ok</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#e6db74">&#34;unlock failed&#34;</span>)
	}
}
</code></pre></div><h3 id="å®ç°åŸç†">å®ç°åŸç†</h3>
<h4 id="åŠ é”">åŠ é”</h4>
<p>åœ¨Newä¸€ä¸ªäº’æ–¥é”mutexåï¼Œé€šè¿‡mutex.Lock()åŠ é”ï¼ŒæŸ¥çœ‹æºç å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Mutex</span>) <span style="color:#a6e22e">acquire</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">pool</span> <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Pool</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">string</span>) (<span style="color:#66d9ef">bool</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pool</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">ctx</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">reply</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">SetNX</span>(<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">expiry</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">reply</span>, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>å¯è§ï¼Œæ˜¯é€šè¿‡Rediså‘½ä»¤Setnxæ“ä½œæ¥å®ç°ã€‚</p>
<p><strong>Redis Setnxï¼ˆSETÂ ifÂ Not eXistsï¼‰ å‘½ä»¤åœ¨æŒ‡å®šçš„ key ä¸å­˜åœ¨æ—¶ï¼Œä¸º key è®¾ç½®æŒ‡å®šçš„å€¼ã€‚è®¾ç½®æˆåŠŸï¼Œè¿”å› 1 ã€‚ è®¾ç½®å¤±è´¥ï¼Œè¿”å› 0 ã€‚ç›¸å¯¹äºSetï¼ŒSetnxå…·æœ‰åŸå­æ€§ã€‚</strong></p>
<h4 id="é‡Šæ”¾é”">é‡Šæ”¾é”</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Mutex</span>) <span style="color:#a6e22e">release</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">pool</span> <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Pool</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">string</span>) (<span style="color:#66d9ef">bool</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">pool</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">ctx</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">deleteScript</span>, <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">value</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">!=</span> int64(<span style="color:#ae81ff">0</span>), <span style="color:#66d9ef">nil</span>
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">deleteScript</span> = <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">NewScript</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">`
</span><span style="color:#e6db74">	if redis.call(&#34;GET&#34;, KEYS[1]) == ARGV[1] then
</span><span style="color:#e6db74">		return redis.call(&#34;DEL&#34;, KEYS[1])
</span><span style="color:#e6db74">	else
</span><span style="color:#e6db74">		return 0
</span><span style="color:#e6db74">	end
</span><span style="color:#e6db74">`</span>)
</code></pre></div><p>å¯è§ï¼ŒRedisä½¿ç”¨Luaè„šæœ¬å‘½ä»¤æ¥Delete Keyæ“ä½œã€‚</p>
<p><strong>è¿™é‡Œéœ€è¦å…³æ³¨åˆ°Delçš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥valueï¼Œvalueæ˜¯åœ¨åŠ é”æ—¶è®¾ç½®çš„éšæœºå”¯ä¸€å€¼ã€‚åœ¨åˆ é™¤å‰è¿›è¡Œæ ¡éªŒvalueæ˜¯å¦ä¸€è‡´ï¼Œé˜²æ­¢è¯¯åˆ </strong>ã€‚</p>
<h4 id="é”è¶…æ—¶-é˜²æ­»é”">é”è¶…æ—¶-é˜²æ­»é”</h4>
<p>å¦‚æœæŒæœ‰é”çš„ç³»ç»Ÿå®•æœºã€å¼‚å¸¸äº†å¯¼è‡´æ²¡æ³•releaseé”ï¼Œé‚£ä¹ˆå…¶ä»–æ–¹å°±æ— æ³•æ´»åŠ¨è¯¥é”ï¼Œå¯¼è‡´æ­»é”ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// NewMutex returns a new distributed mutex with given name.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Redsync</span>) <span style="color:#a6e22e">NewMutex</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">options</span> <span style="color:#f92672">...</span><span style="color:#a6e22e">Option</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Mutex</span> {
	<span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Mutex</span>{
		<span style="color:#a6e22e">name</span>:   <span style="color:#a6e22e">name</span>,
		<span style="color:#a6e22e">expiry</span>: <span style="color:#ae81ff">8</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>,
		<span style="color:#a6e22e">tries</span>:  <span style="color:#ae81ff">32</span>,
		<span style="color:#a6e22e">delayFunc</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">tries</span> <span style="color:#66d9ef">int</span>) <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span> {
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#a6e22e">maxRetryDelayMilliSec</span><span style="color:#f92672">-</span><span style="color:#a6e22e">minRetryDelayMilliSec</span>)<span style="color:#f92672">+</span><span style="color:#a6e22e">minRetryDelayMilliSec</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Millisecond</span>
		},
		<span style="color:#a6e22e">genValueFunc</span>:  <span style="color:#a6e22e">genValue</span>,
		<span style="color:#a6e22e">driftFactor</span>:   <span style="color:#ae81ff">0.01</span>,
		<span style="color:#a6e22e">timeoutFactor</span>: <span style="color:#ae81ff">0.05</span>,
		<span style="color:#a6e22e">quorum</span>:        len(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">pools</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,
		<span style="color:#a6e22e">pools</span>:         <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">pools</span>,
	}
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">o</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">options</span> {
		<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">Apply</span>(<span style="color:#a6e22e">m</span>)
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">m</span>
}
</code></pre></div><p>å¯è§ï¼ŒMutex.expiy è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º8ç§’ï¼Œå¯ä»¥é€šè¿‡Optionä¿®æ”¹è¶…æ—¶æ—¶é—´</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// WithExpiry can be used to set the expiry of a mutex to the given value.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">WithExpiry</span>(<span style="color:#a6e22e">expiry</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>) <span style="color:#a6e22e">Option</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">OptionFunc</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Mutex</span>) {
		<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">expiry</span> = <span style="color:#a6e22e">expiry</span>
	})
}
</code></pre></div><p>Exampleï¼ˆè®¾ç½®è¶…æ—¶æ—¶é—´ã€é‡å¤åŠ é”ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//è®¾ç½®é”è¶…æ—¶3ç§’
</span><span style="color:#75715e"></span><span style="color:#a6e22e">mutex</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">NewMutex</span>(<span style="color:#a6e22e">mutexname</span>,<span style="color:#a6e22e">redsync</span>.<span style="color:#a6e22e">WithExpiry</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span><span style="color:#f92672">*</span><span style="color:#ae81ff">3</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
    <span style="color:#75715e">//é‡å¤åŠ é”
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
<span style="color:#a6e22e">OutPut</span><span style="color:#960050;background-color:#1e0010">ï¼š</span>

<span style="color:#a6e22e">panic</span>: <span style="color:#a6e22e">lock</span> <span style="color:#a6e22e">already</span> <span style="color:#a6e22e">taken</span>, <span style="color:#a6e22e">locked</span> <span style="color:#a6e22e">nodes</span>: [<span style="color:#ae81ff">0</span>]
</code></pre></div><p>Exampleï¼ˆè®¾ç½®è¶…æ—¶æ—¶é—´ã€è¶…æ—¶é‡Šæ”¾é”ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">//è®¾ç½®é”è¶…æ—¶10ç§’
</span><span style="color:#75715e"></span><span style="color:#a6e22e">mutex</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rs</span>.<span style="color:#a6e22e">NewMutex</span>(<span style="color:#a6e22e">mutexname</span>,<span style="color:#a6e22e">redsync</span>.<span style="color:#a6e22e">WithExpiry</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
    <span style="color:#75715e">//11ç§’åé”è¶…æ—¶ï¼Œé‡Šæ”¾
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">11</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
    <span style="color:#75715e">//é‡å¤åŠ é”ä½†å·²é‡Šæ”¾ã€æ— å¼‚å¸¸
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mutex</span>.<span style="color:#a6e22e">Lock</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}
<span style="color:#a6e22e">OutPut</span><span style="color:#960050;background-color:#1e0010">ï¼š</span>
</code></pre></div><h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»åˆ†å¸ƒå¼é”çš„åŸºç¡€æ¦‚å¿µã€ç‰¹æ€§äº’æ–¥æ€§ã€é˜²æ­»é”ã€é«˜å¯ç”¨é«˜æ€§èƒ½ã€‚ä»¥åŠgolangåŸºäºredisï¼Œä½¿ç”¨go-redsyncåº“å®ç°åˆ†å¸ƒå¼é”ã€‚é€šè¿‡ä¾‹å­ç®€å•ä»‹ç»go-redsyncçš„å…¥é—¨ä½¿ç”¨ï¼Œä»¥åŠé€šè¿‡æºç é˜…è¯»æ¥åˆ¨æç®€ä»‹å®ç°åŸç†ï¼š 1.åˆ©ç”¨Redis SetnxåŸå­æ€§å®ç°äº’æ–¥æ€§ ï¼Œ2.åˆ©ç”¨Redisæ‰§è¡Œluaè„šæœ¬ã€æ£€æŸ¥valueå€¼é¿å…è¯¯åˆ æ“ä½œï¼Œ 3.é€šè¿‡è®¾ç½®ExpiryOptionè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå®ç°é”è¶…æ—¶ã€é¿å…æ­»é”ã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li><a href="https://redis.io/docs/manual/patterns/distributed-locks/">redis.io/docs ä½¿ç”¨ Redis çš„åˆ†å¸ƒå¼é”</a></li>
<li><a href="https://github.com/go-redsync/redsync">redsync</a></li>
<li><a href="https://www.modb.pro/db/531964/">redsyncæºç ä»‹ç»</a></li>
<li><a href="https://mp.weixin.qq.com/s/k_dX2HF8hTf6XseeeXYivg">redis goå®ç°æ–¹å¼</a></li>
<li><a href="https://xiaorui.cc/archives/3028">å³°äº‘ -redigoå®ç°</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2023/01/go%E5%9F%BA%E4%BA%8Eredis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/12/golang-linters%E8%81%9A%E5%90%88%E5%99%A8golangci-lint/" aria-label="">
      
          Golang Lintersèšåˆå™¨golangci Lint
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-12-18T17:23:05&#43;08:00">
        
   18, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/go">go</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>æœ¬æ–‡ç®€è¦ä»‹ç»goå®ç°lintå’Œgolangci-lintä½¿ç”¨ã€‚</p>
<h3 id="what">what</h3>
<p>linterä¸ºé™æ€ä»£ç æ£€æŸ¥ã€åˆ†æå·¥å…·ï¼Œgolangå¸¸è§çš„æœ‰govet\golint\errcheck ç­‰ã€‚é€šè¿‡å·¥å…·å…¶ä¸€ï¼Œå¯ä»¥æå‰å‘ç°ä¸€äº›è¯­æ³•é—®é¢˜ï¼Œæ¯”å¦‚å˜é‡ä½œç”¨åŸŸé—®é¢˜ã€æ•°ç»„ä¸‹æ ‡è¶Šç•Œã€å†…å­˜æ³„éœ²ç­‰ï¼›å…¶äºŒå¯ä»¥æ ¹æ®å›¢é˜Ÿè§„èŒƒå®šåˆ¶lintè§„åˆ™ï¼Œæå‡å¯è¯»æ€§ï¼Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>golangçš„lintersæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ <a href="https://github.com/golangci/awesome-go-linters">awesome-go-linters</a>ä¸­ golintæ£€æŸ¥å˜é‡ã€å‡½æ•°åã€æ³¨é‡Šç­‰ã€‚errcheckä¸ºæœªæ£€æŸ¥é”™è¯¯ç­‰ã€‚golangci-lintæ˜¯ä¸€ä¸ª Go linters èšåˆå™¨ï¼Œé€šè¿‡é…ç½®æ¥é€‰æ‹©éœ€è¦çš„lintersã€‚å…¶ç‰¹å¾å¦‚ä¸‹ï¼š</p>
<ul>
<li>âš¡éå¸¸å¿«:å¹¶è¡Œè¿è¡Œlintersï¼Œé‡ç”¨Goæ„å»ºç¼“å­˜å’Œç¼“å­˜åˆ†æç»“æœã€‚</li>
<li>âš™ï¸åŸºäºyamlçš„é…ç½®</li>
<li>ğŸ–¥é›†æˆVS Code, Sublime Text, GoLand, GNU Emacs, Vim, Atom, GitHubåŠ¨ä½œã€‚</li>
<li>ğŸ¥‡åŒ…å«äº†å¾ˆå¤šlintersï¼Œä¸éœ€è¦å®‰è£…å®ƒä»¬ã€‚</li>
<li>ğŸ“ˆç”±äºè°ƒä¼˜çš„é»˜è®¤è®¾ç½®å¯¼è‡´çš„æœ€å°è¯¯æŠ¥æ•°ã€‚</li>
<li>ğŸ”¥æ¼‚äº®çš„è¾“å‡ºé¢œè‰²ï¼Œæºä»£ç è¡Œå’Œæ ‡è®°çš„æ ‡è¯†ç¬¦ã€‚</li>
</ul>
<h3 id="install">install</h3>
<h4 id="mac">mac</h4>
<p>macOSä½ å¯ä»¥ä½¿ç”¨brewåœ¨macOSä¸Šå®‰è£…äºŒè¿›åˆ¶ç‰ˆæœ¬:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">brew install golangci-lint
brew upgrade golangci-lint
</code></pre></div><h4 id="install-from-source">Install from Source</h4>
<p>æºç å®‰è£…:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&gt; go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.50.1
</code></pre></div><p>æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸï¼š</p>
<pre tabindex="0"><code>&gt;golangci-lint --version
&gt;golangci-lint has version v1.50.1 built from (unknown, mod sum: &quot;h1:C829clMcZXEORakZlwpk7M4iDw2XiwxxKaG504SZ9zY=&quot;) on (unknown)
</code></pre><h3 id="how">how</h3>
<p>GolangCI-Lint å¯ä»¥é›¶é…ç½®ä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨ä»¥ä¸‹ linters</p>
<pre tabindex="0"><code>&gt;golangci-lint help linters
&gt;Enabled by default linters:
errcheck: Errcheck is a program for checking for unchecked errors in go programs. These unchecked errors can be critical bugs in some cases [fast: false, auto-fix: false]
gosimple (megacheck): Linter for Go source code that specializes in simplifying code [fast: false, auto-fix: false]
govet (vet, vetshadow): Vet examines Go source code and reports suspicious constructs, such as Printf calls whose arguments do not align with the format string [fast: false, auto-fix: false]
ineffassign: Detects when assignments to existing variables are not used [fast: true, auto-fix: false]
staticcheck (megacheck): It's a set of rules from staticcheck. It's not the same thing as the staticcheck binary. The author of staticcheck doesn't support or approve the use of staticcheck as a library inside golangci-lint. [fast: false, auto-fix: false]
typecheck: Like the front-end of a Go compiler, parses and type-checks Go code [fast: false, auto-fix: false]
unused (megacheck): Checks Go code for unused constants, variables, functions and types [fast: false, auto-fix: false]
</code></pre><p>å¦‚ä½•æ‰§è¡Œgolangci-lintå‘¢ï¼Ÿåœ¨éœ€è¦æ‰§è¡Œçš„é¡¹ç›®ç›®å½•ä¸‹ï¼š</p>
<pre tabindex="0"><code>golangci-lint run
</code></pre><p>è¿™ç›¸å½“äºæ‰§è¡Œ</p>
<pre tabindex="0"><code>golangci-lint run ./...
</code></pre><p>æ‚¨å¯ä»¥é€‰æ‹©è¦åˆ†æçš„ç›®å½•å’Œæ–‡ä»¶:</p>
<pre tabindex="0"><code>golangci-lint run dir1 dir2/... dir3/file1.go
</code></pre><p>æ¥ç€ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªExampleä»£ç ï¼šlinter_example.go</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">People</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">People</span>) <span style="color:#a6e22e">String</span>() <span style="color:#66d9ef">string</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;print: %v&#34;</span>, <span style="color:#a6e22e">p</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">People</span>{}
	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">String</span>()
}


</code></pre></div><p>æ‰§è¡Œlintï¼Œå¦‚æœæ²¡æœ‰ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œä¼šèµ°é»˜è®¤çš„linté…ç½®</p>
<pre tabindex="0"><code>&gt; golangci-lint run
level=warning msg=&quot;[runner] The linter 'golint' is deprecated (since v1.41.0) due to: The repository of the linter has been archived b
y the owner.  Replaced by revive.&quot;
linter_example.go:5:6: exported type `People` should have comment or be unexported (golint)
type People struct {
     ^
linter_example.go:10:9: printf: fmt.Sprintf format %v with arg p causes recursive (*demos/linter-demo.People).String method call (gove
t)
        return fmt.Sprintf(&quot;print: %v&quot;, p)
               ^
linter_example.go:15:10: unusedresult: result of (*demos/linter-demo.People).String call not used (govet)
        p.String()
                ^

</code></pre><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®lintæç¤ºä¿®æ”¹</p>
<pre tabindex="0"><code> printf: fmtã€‚Sprintfæ ¼å¼%vä¸arg på¯¼è‡´é€’å½’( demos/ lininter -demo. people)ã€‚å­—ç¬¦ä¸²æ–¹æ³•è°ƒç”¨(govet)ã€‚
</code></pre><p>åœ¨ä½¿â½¤Â  fmt åŒ…ä¸­çš„æ‰“å°â½…æ³•æ—¶ï¼Œå¦‚æœç±»å‹å®ç°äº†è¿™ä¸ªæ¥â¼ï¼Œä¼šç›´æ¥è°ƒâ½¤ã€‚â½½ä¸­æ‰“å°Â  p çš„æ—¶å€™ä¼šç›´æ¥è°ƒâ½¤Â  p å®ç°çš„Â  String() â½…æ³•ï¼Œç„¶åå°±äº§â½£äº†å¾ªç¯è°ƒâ½¤ã€‚</p>
<h4 id="custom-configuration">Custom Configuration</h4>
<p>GolangCI-Lint  é€šè¿‡å½“å‰å·¥ä½œç›®å½•çš„ä»¥ä¸‹è·¯å¾„ä¸­å¢åŠ é…ç½®æ–‡ä»¶ï¼š</p>
<ul>
<li>.golangci.yml</li>
<li>.golangci.yaml</li>
<li>.golangci.toml</li>
<li>.golangci.json</li>
</ul>
<p>æ¥å®ç°è‡ªå®šä¹‰linters</p>
<p>ä¾‹å¦‚æˆ‘ä»¬æ·»åŠ äº†.golangci.yml</p>
<pre tabindex="0"><code>run:
  timeout: 5m
  modules-download-mode: readonly

linters:
  disable-all: true
  enable: # ä¸‹é¢æ˜¯å¼€å¯çš„lintåˆ—è¡¨
    - errcheck
    - goimports
    - golint
   # - govet ä¸ºäº†æµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆï¼Œå…³é—­
    - staticcheck

linters-settings:
  golint:
    # minimal confidence for issues, default is 0.8
    min-confidence: 0.8

issues:
  exclude-use-default: false
  max-issues-per-linter: 0
  max-same-issues: 0
</code></pre><p>è¿™é‡Œæˆ‘ä»¬æŠŠgovet å…³é—­äº†ï¼Œåœ¨æ‰§è¡Œrun</p>
<pre tabindex="0"><code>golangci-lint run
level=warning msg=&quot;[runner] The linter 'golint' is deprecated (since v1.41.0) due to: The repository of the linter has been archived b
y the owner.  Replaced by revive.&quot;
linter_example.go:5:6: exported type `People` should have comment or be unexported (golint)
type People struct {
     ^
</code></pre><p>å¯è§å…³é—­govetç”Ÿæ•ˆäº†ã€‚</p>
<h3 id="reference">reference</h3>
<ul>
<li>golangci-lint  <a href="https://github.com/golangci/golangci-lint">https://github.com/golangci/golangci-lint</a></li>
<li>golangci-lint doc <a href="https://golangci-lint.run/">https://golangci-lint.run/</a></li>
<li>lint  <a href="https://github.com/golang/lint">https://github.com/golang/lint</a></li>
<li>awesome-go-linters <a href="https://github.com/golangci/awesome-go-linters">https://github.com/golangci/awesome-go-linters</a></li>
<li>bolg gocn  <a href="https://mp.weixin.qq.com/s/kNh0TP59fCFJhbmr-YMz4Q">https://mp.weixin.qq.com/s/kNh0TP59fCFJhbmr-YMz4Q</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2022/12/golang-linters%E8%81%9A%E5%90%88%E5%99%A8golangci-lint/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/12/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E5%85%A5ubuntu/" aria-label="">
      
          SSHå…å¯†ç™»å…¥Ubuntu
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-12-10T17:15:17&#43;08:00">
        
   10, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/devops">DevOps</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>æœ¬æ–‡ä¸»è¦ä»‹ç»sshå…å¯†è®¿é—®Ubuntuã€‚</p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<p>What is SSH:</p>
<blockquote>
<p>SSH ä¸ºÂ Secure ShellÂ çš„ç¼©å†™ï¼Œç”± IETF çš„ç½‘ç»œå°ç»„ï¼ˆNetwork Working Groupï¼‰æ‰€åˆ¶å®šï¼›SSH ä¸ºå»ºç«‹åœ¨åº”ç”¨å±‚åŸºç¡€ä¸Šçš„å®‰å…¨åè®®ã€‚SSH æ˜¯è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚åˆ©ç”¨ SSH åè®®å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç¨‹ç®¡ç†è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æ³„éœ²é—®é¢˜</p>
</blockquote>
<p>SSHå¹¿æ³›ä½¿ç”¨çš„åè®®ï¼Œç”¨äºå®‰å…¨çš„è®¿é—®LinuxæœåŠ¡å™¨ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»sshå…å¯†è®¿é—®Ubuntuï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ï¼ˆmacï¼‰</li>
<li>æœåŠ¡å™¨ï¼ˆUbuntuï¼‰</li>
</ul>
<p>å®ç°æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®‰è£…sshæœåŠ¡</li>
<li>sshå®¢æˆ·ç«¯ç”Ÿæˆç”Ÿæˆå…¬é’¥å’Œç§é’¥</li>
<li>ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨</li>
</ol>
<h3 id="å®‰è£…sshçš„æœåŠ¡ç«¯">å®‰è£…sshçš„æœåŠ¡ç«¯</h3>
<p>åœ¨Ubuntuå®‰è£…sshæœåŠ¡ï¼ˆè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯vmé»˜è®¤å®‰è£…ï¼‰ï¼š</p>
<pre tabindex="0"><code>sudo apt-get install openssh-server
</code></pre><p>é‡å¯æœåŠ¡</p>
<pre tabindex="0"><code>service ssh restart
</code></pre><h3 id="sshç”Ÿæˆå¯†é’¥">sshç”Ÿæˆå¯†é’¥</h3>
<p>åœ¨Macï¼Œç”Ÿæˆå¯†é’¥çš„å‘½ä»¤ï¼š</p>
<pre tabindex="0"><code>ssh-keygen
</code></pre><p>ç”Ÿæˆçš„å¯†é’¥è·¯å¾„: $HOME/.ssh
æŸ¥çœ‹æ˜¯å¦ç”ŸæˆæˆåŠŸï¼š</p>
<pre tabindex="0"><code>cd $HOME/.ssh
ls
id_rsa      id_rsa.pub
</code></pre><p>è¯´æ˜ç”ŸæˆæˆåŠŸï¼Œå…¶ä¸­id_rsaä¸ºç§é’¥ã€id_rsa.pubä¸ºå…¬é’¥ã€‚å…¬é’¥å°†ä¸Šä¼ åˆ°ä½ è¦è¿æ¥çš„æœåŠ¡å™¨ï¼Œè€Œç§é’¥åˆ™å­˜å‚¨åœ¨ä½ å°†ç”¨æ¥å»ºç«‹è¿æ¥çš„è®¡ç®—æœºä¸Šã€‚æ¥ç€ï¼Œå°†å…¬é’¥é’¥ä¸Šä¼ åˆ°Ubuntuï¼š</p>
<pre tabindex="0"><code>ssh-copy-id userName@ServerIp
</code></pre><p>Eg:</p>
<pre tabindex="0"><code>ssh-copy-id jefffff@192.168.1.88
</code></pre><p>æ¥ç€ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¸Šä¼ æˆåŠŸï¼Œ å¯†é’¥ä¼šå¢åŠ åˆ°Ubuntuï¼Œè·¯å¾„ä¸º$HOME/.ssh/authorized_key</p>
<h3 id="å…å¯†è®¿é—®">å…å¯†è®¿é—®</h3>
<p>æ¥ç€å°±å¯ä»¥sshå…å¯†è®¿é—®æœåŠ¡å™¨äº†ï¼š</p>
<pre tabindex="0"><code>ssh -i ~/.ssh/id_rsa -p 22 -l userName ServerIp
</code></pre><p>Egï¼šï¼š</p>
<pre tabindex="0"><code> [master] ssh -i ~/.ssh/id_rsa -p 22 -l jefffff 192.168.1.88
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-131-generic x86_64)
... çœç•¥ä¸€äº›

*** System restart required ***
Last login: Sat Dec  9 09:21:34 2022 from 192.168.1.33
jeffffff@ubuntu1~$
</code></pre><p>è¯´æ˜ï¼Œç™»å…¥æˆåŠŸã€‚</p>
<h3 id="iterm2é…ç½®">iterm2é…ç½®</h3>
<p>ä¸ºäº†æ›´æ–¹ä¾¿çš„è®¿é—®ï¼Œå¯ä»¥åœ¨iterm2ï¼ˆmacï¼‰é…ç½®
<img src="https://luckytking.github.io/images/ssh-iterm2.png" alt=""></p>
<h3 id="å°ç»“">å°ç»“</h3>
<p>ä½¿ç”¨SSHçš„è®¿é—®Linuxæ–¹å¼æœ‰å¯†ç å’Œå¯†é’¥ä¸¤ç§æ–¹å¼ï¼Œä½¿ç”¨å¯†é’¥ç›¸å¯¹äºé»˜è®¤çš„å¯†ç æ–¹å¼ä¼˜ç‚¹æœ‰ï¼š
å…¶ä¸€ï¼Œå¯†ç æ›´å®¹æ˜“è¢«æš´åŠ›ç ´è§£ï¼Œå¯†é’¥è®¿é—®æ›´å®‰å…¨ã€‚
å…¶äºŒï¼Œäº¦å¯é€šè¿‡ä¿®æ”¹sshd_configé…ç½®ï¼Œæ¥å¼€é—­ç”¨æˆ·å¯¹æœåŠ¡å™¨çš„è®¿é—®ã€‚
æ–‡ä¸­è¿˜é€šè¿‡ä¸€ä¸ªMacå¯†é’¥ç™»å…¥Ubuntuçš„ä¾‹å­ï¼Œæ¥æ¼”ç¤ºå…å¯†è®¿é—®è¿‡ç¨‹ã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li><a href="https://www.ssh.com/academy/ssh">sshä»‹ç»</a></li>
<li><a href="https://baike.baidu.com/item/ssh/10407?fr=aladdin">ç™¾åº¦ç™¾ç§‘: ä»€ä¹ˆæ˜¯SSH</a></li>
<li><a href="https://jingwei.link/2018/12/08/ssh-login-style.html">ubuntu-sshç”¨æˆ·åå¯†ç ç™»å½•ä¸è¯ä¹¦å…å¯†ç™»å½•</a></li>
<li><a href="https://www.myfreax.com/how-to-set-up-ssh-keys-on-ubuntu-20-04/">å¦‚ä½•åœ¨Ubuntu 20.04é…ç½®SSHå¯†é’¥å…å¯†ç ç™»å½•</a></li>
<li><a href="https://iterm2.com/">iterm2.com</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2022/12/ssh%E5%85%8D%E5%AF%86%E7%99%BB%E5%85%A5ubuntu/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/12/go%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D/" aria-label="">
      
          Goæµ…æ‹·è´ä¸æ·±æ‹·è´
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-12-04T16:44:31&#43;08:00">
        
   4, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/go">go</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>æœ¬æ–‡ä¸»è¦ä»‹ç»Goå®ç°æµ…æ‹·è´å’Œæ·±æ‹·è´ï¼Œä»¥åŠå·¥å…·åº“mohae/deepcopyã€‚</p>
<h3 id="å®šä¹‰">å®šä¹‰</h3>
<blockquote>
<p>æµ…æ‹·è´æ˜¯æŒ‰ä½æ‹·è´å¯¹è±¡ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ç€åŸå§‹å¯¹è±¡å±æ€§å€¼çš„ä¸€ä»½ç²¾ç¡®æ‹·è´ã€‚å¦‚æœå±æ€§æ˜¯åŸºæœ¬ç±»å‹ï¼Œæ‹·è´çš„å°±æ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼›å¦‚æœå±æ€§æ˜¯å†…å­˜åœ°å€ï¼ˆå¼•ç”¨ç±»å‹ï¼‰ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€ ï¼Œå› æ­¤å¦‚æœå…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ”¹å˜äº†è¿™ä¸ªåœ°å€ï¼Œå°±ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚å³é»˜è®¤æ‹·è´æ„é€ å‡½æ•°åªæ˜¯å¯¹å¯¹è±¡è¿›è¡Œæµ…æ‹·è´å¤åˆ¶(é€ä¸ªæˆå‘˜ä¾æ¬¡æ‹·è´)ï¼Œå³åªå¤åˆ¶å¯¹è±¡ç©ºé—´è€Œä¸å¤åˆ¶èµ„æº</p>
</blockquote>
<blockquote>
<p>æ·±æ‹·è´æ˜¯æŒ‡æºå¯¹è±¡ä¸æ‹·è´å¯¹è±¡äº’ç›¸ç‹¬ç«‹ï¼Œå…¶ä¸­ä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„æ”¹åŠ¨éƒ½ä¸ä¼šå¯¹å¦å¤–ä¸€ä¸ªå¯¹è±¡é€ æˆå½±å“ã€‚æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯Valueï¼ˆå€¼ï¼‰å¯¹è±¡ï¼Œå¦‚é¢„å®šä¹‰ç±»å‹Int32ï¼ŒDoubleï¼Œä»¥åŠç»“æ„ï¼ˆstructï¼‰ï¼Œæšä¸¾ï¼ˆEnumï¼‰ç­‰</p>
</blockquote>
<h3 id="æµ…æ‹·è´">æµ…æ‹·è´</h3>
<p>goä½¿ç”¨<strong>copy</strong>å†…ç½®å‡½æ•°å°†æºç‰‡ä¸­çš„å…ƒç´ å¤åˆ¶åˆ°ç›®æ ‡åˆ‡ç‰‡,å¦‚æœæ‹·è´çš„
ç»“æ„ä¸­ä¸åŒ…å«æŒ‡é’ˆæ˜¯æ²¡é—®é¢˜ï¼Œå¦åˆ™åˆ™æ•°æ®æºå’Œæ‹·è´ä¹‹é—´å¯¹åº”æŒ‡é’ˆä¼šå…±åŒæŒ‡å‘åŒä¸€å—å†…å­˜ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">shallowCopyReference</span>() {
	<span style="color:#a6e22e">brazil</span> <span style="color:#f92672">:=</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">Player</span>{{<span style="color:#e6db74">&#34;Neymar&#34;</span>}, {<span style="color:#e6db74">&#34;Messi&#34;</span>}}
	<span style="color:#a6e22e">argentina</span> <span style="color:#f92672">:=</span> make([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Player</span>, len(<span style="color:#a6e22e">brazil</span>))
	copy(<span style="color:#a6e22e">argentina</span>, <span style="color:#a6e22e">brazil</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p, %p\n&#34;</span>, <span style="color:#a6e22e">brazil</span>, <span style="color:#a6e22e">brazil</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p, %p\n&#34;</span>, <span style="color:#a6e22e">argentina</span>, <span style="color:#a6e22e">argentina</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">brazil</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">Name</span> = <span style="color:#e6db74">&#34;Anthony&#34;</span>
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p, %v, %p\n&#34;</span>, <span style="color:#a6e22e">brazil</span>, <span style="color:#a6e22e">brazil</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%p, %v, %p\n&#34;</span>, <span style="color:#a6e22e">argentina</span>, <span style="color:#a6e22e">argentina</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>[<span style="color:#ae81ff">0</span>])
}
<span style="color:#75715e">//output
</span><span style="color:#75715e"></span><span style="color:#ae81ff">0xc0000412e0</span>, <span style="color:#ae81ff">0xc0000412f0</span>
<span style="color:#ae81ff">0xc000041310</span>, <span style="color:#ae81ff">0xc0000412f0</span>
<span style="color:#ae81ff">0xc0000412e0</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Anthony</span>}, <span style="color:#ae81ff">0xc0000412f0</span>
<span style="color:#ae81ff">0xc000041310</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Anthony</span>}, <span style="color:#ae81ff">0xc0000412f0</span> 
</code></pre></div><p>å¦‚ä¸Šï¼Œä¿®æ”¹äº†srcï¼ˆæ‹·è´åŸå§‹ç»“æ„ï¼‰çš„æŒ‡é’ˆå¯¹è±¡ï¼Œdstï¼ˆæ‹·è´ç›®æ ‡ç»“æ„ï¼‰çš„å€¼ä¹Ÿè¢«æ”¹åŠ¨äº†ï¼Œæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚</p>
<h3 id="æ·±æ‹·è´">æ·±æ‹·è´</h3>
<h4 id="æ–¹æ³•ä¸€gobjson-åºåˆ—åŒ–æˆå­—èŠ‚åºåˆ—å†ååºåˆ—åŒ–ç”Ÿæˆå…‹éš†å¯¹è±¡">æ–¹æ³•ä¸€ï¼šgobã€json åºåˆ—åŒ–æˆå­—èŠ‚åºåˆ—å†ååºåˆ—åŒ–ç”Ÿæˆå…‹éš†å¯¹è±¡</h4>
<ul>
<li>gobåºåˆ—åŒ–</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">deepCopyByGobExample</span>() {
	<span style="color:#a6e22e">players</span> <span style="color:#f92672">:=</span> append([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Player</span>{}, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Player</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;Neymar&#34;</span>}, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Player</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;Messi&#34;</span>})
	<span style="color:#a6e22e">brazil</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Team</span>{<span style="color:#a6e22e">Players</span>: <span style="color:#a6e22e">players</span>}
	<span style="color:#a6e22e">argentina</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Team</span>{}
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">deepCopyByGob</span>(<span style="color:#a6e22e">brazil</span>, <span style="color:#a6e22e">argentina</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;deepcopy error:&#34;</span>, <span style="color:#a6e22e">err</span>)
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v,%v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;brazil&#34;</span>, <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v,%v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;argentina&#34;</span>, <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">Name</span> = <span style="color:#e6db74">&#34;Anthony&#34;</span>
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;brazil&#34;</span>, <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;argentina&#34;</span>, <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">deepCopyByGob</span>(<span style="color:#a6e22e">dst</span>, <span style="color:#a6e22e">src</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Team</span>) <span style="color:#66d9ef">error</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">buf</span> <span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">Buffer</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gob</span>.<span style="color:#a6e22e">NewEncoder</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">buf</span>).<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">src</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">gob</span>.<span style="color:#a6e22e">NewDecoder</span>(<span style="color:#a6e22e">bytes</span>.<span style="color:#a6e22e">NewBuffer</span>(<span style="color:#a6e22e">buf</span>.<span style="color:#a6e22e">Bytes</span>())).<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">dst</span>)
}
<span style="color:#75715e">//output
</span><span style="color:#75715e"></span><span style="color:#a6e22e">brazil</span>,<span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc000184ff0</span>
<span style="color:#a6e22e">argentina</span>,<span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc000185330</span>
<span style="color:#a6e22e">brazil</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Anthony</span>}, <span style="color:#ae81ff">0xc000184ff0</span>
<span style="color:#a6e22e">argentina</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc000184ff0</span> 
</code></pre></div><ul>
<li>jsonåºåˆ—åŒ–</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">deepcopyByJsonExample</span>() {
	<span style="color:#a6e22e">players</span> <span style="color:#f92672">:=</span> append([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Player</span>{}, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Player</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;Neymar&#34;</span>}, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Player</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;Messi&#34;</span>})
	<span style="color:#a6e22e">brazil</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Team</span>{<span style="color:#a6e22e">Players</span>: <span style="color:#a6e22e">players</span>}
	<span style="color:#a6e22e">argentina</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Team</span>{}
	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">deepCopyByJson</span>(<span style="color:#a6e22e">brazil</span>, <span style="color:#a6e22e">argentina</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;deepcopy error:&#34;</span>, <span style="color:#a6e22e">err</span>)
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v,%v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;brazil&#34;</span>, <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v,%v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;argentina&#34;</span>, <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">Name</span> = <span style="color:#e6db74">&#34;Anthony&#34;</span>
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;brazil&#34;</span>, <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;argentina&#34;</span>, <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">deepCopyByJson</span>(<span style="color:#a6e22e">src</span>, <span style="color:#a6e22e">dst</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Team</span>) <span style="color:#66d9ef">error</span> {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tmp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">src</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
	} <span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">tmp</span>, <span style="color:#a6e22e">dst</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
	}
}
<span style="color:#75715e">//output
</span><span style="color:#75715e"></span><span style="color:#a6e22e">brazil</span>,<span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc0000412e0</span>
<span style="color:#a6e22e">argentina</span>,<span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc000041490</span>
<span style="color:#a6e22e">brazil</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Anthony</span>}, <span style="color:#ae81ff">0xc0000412e0</span>
<span style="color:#a6e22e">argentina</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc0000412e0</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°deepcopyå‡ºæ¥çš„æŒ‡é’ˆåœ°å€ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆéƒ½dstçš„ä¿®æ”¹å°±ä¸ä¼šå½±å“åˆ°srcäº†ã€‚</p>
<h4 id="æ–¹æ³•äºŒä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·åº“">æ–¹æ³•äºŒï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·åº“</h4>
<p>DeepCopyå¯¹äº‹ç‰©è¿›è¡Œæ·±åº¦å¤åˆ¶:æœªå¯¼å‡ºçš„å­—æ®µå€¼ä¸ä¼šè¢«å¤åˆ¶ã€‚
feature:</p>
<ul>
<li>copy slice</li>
<li>copy map</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">deepCopyExample</span>() {
	<span style="color:#a6e22e">brazil</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Team</span>{<span style="color:#a6e22e">Players</span>: append([]<span style="color:#f92672">*</span><span style="color:#a6e22e">Player</span>{}, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Player</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;Neymar&#34;</span>}, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Player</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;Messi&#34;</span>})}
	<span style="color:#a6e22e">argentinaIfc</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">deepcopy</span>.<span style="color:#a6e22e">Copy</span>(<span style="color:#a6e22e">brazil</span>)
	<span style="color:#a6e22e">argentina</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">argentinaIfc</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">Team</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v,%v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;brazil&#34;</span>, <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v,%v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;argentina&#34;</span>, <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">Name</span> = <span style="color:#e6db74">&#34;Anthony&#34;</span>
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;brazil&#34;</span>, <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %v, %p\n&#34;</span>, <span style="color:#e6db74">&#34;argentina&#34;</span>, <span style="color:#a6e22e">argentina</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">brazil</span>.<span style="color:#a6e22e">Players</span>[<span style="color:#ae81ff">0</span>])
}
<span style="color:#75715e">//output
</span><span style="color:#75715e"></span><span style="color:#a6e22e">brazil</span>,<span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc0000412e0</span>
<span style="color:#a6e22e">argentina</span>,<span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc000041330</span>
<span style="color:#a6e22e">brazil</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Anthony</span>}, <span style="color:#ae81ff">0xc0000412e0</span>
<span style="color:#a6e22e">argentina</span>, <span style="color:#f92672">&amp;</span>{<span style="color:#a6e22e">Neymar</span>}, <span style="color:#ae81ff">0xc0000412e0</span>
</code></pre></div><h3 id="å°ç»“">å°ç»“</h3>
<p>æµ…æ‹·è´æ˜¯å€¼çš„æ‹·è´ï¼Œå¦‚æœå±æ€§æ˜¯å¼•ç”¨ï¼Œæ‹·è´çš„å°±æ˜¯å†…å­˜åœ°å€ï¼Œéœ€è¦ä½¿ç”¨æ·±æ‹·è´ã€‚æ·±æ‹·è´çš„å®ç°åŸç†æœ¬è´¨ä¸Šæ˜¯é€šè¿‡åå°„å®ç°ã€‚é€šè¿‡å°†æºå¯¹è±¡è½¬æ¢æˆæ¥å£ï¼Œå†å¯¹æ¥å£é€šè¿‡åå°„åˆ¤æ–­å…¶ç±»å‹ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡åºåˆ—åŒ–æˆgobã€jsonç­‰æ¥å®ç°ã€‚å·¥å…·åº“mohae/deepcopyå¯ä»¥å¯¹åˆ‡ç‰‡ã€mapã€ç»“æ„ä½“ã€æ¥å£è¿›è¡Œæ·±æ‹·è´ï¼Œæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li><a href="https://github.com/mohae/deepcopy">modae/deepcopy</a></li>
<li><a href="https://juejin.cn/post/7143030425839992863">modae/deepcopyå®ç°åŸç†åˆ†æ</a></li>
<li><a href="https://juejin.cn/post/7143030425839992863">goæ·±æ‹·è´å¸¸è§æ–¹å¼åŠæ€§èƒ½</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2022/12/go%E6%B5%85%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B7%B1%E6%8B%B7%E8%B4%9D/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/11/go%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7-%E7%BB%98%E5%88%B6%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84%E5%92%8C%E4%BE%9D%E8%B5%96/" aria-label="">
      
          Goå¯è§†åŒ–å·¥å…· ç»˜åˆ¶é¡¹ç›®ä»£ç ç»“æ„å’Œä¾èµ–
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-11-27T12:24:50&#43;08:00">
        
   27, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/go">go</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>æ¯”è¾ƒå¸¸è§pprofÂ å¯ä»¥æŠŠè°ƒç”¨æ ˆå¯è§†åŒ–æˆè°ƒç”¨å›¾ï¼Œembedded-struct-visualizer å¯ä»¥æŠŠGo çš„é¡¹ç›®çš„ä»£ç åˆ†å±‚ç»“æ„å’Œä¾èµ–éƒ½å¯è§†åŒ–æˆæµç¨‹å›¾ã€‚</p>
<h3 id="å®‰è£…-embedded-struct-visualizer">å®‰è£… embedded-struct-visualizer</h3>
<pre tabindex="0"><code> go install github.com/davidschlachter/embedded-struct-visualizer@latest
</code></pre><p>æŸ¥çœ‹å‘½ä»¤é€‰é¡¹å‚æ•°</p>
<pre tabindex="0"><code>embedded-struct-visualizer -h
Usage: [OPTIONS] DirToScan
If the directory to scan is not provided, it defaults to './'
OPTIONS:
  -out &lt;file&gt;  path to output file (default: write to stdout)
  -v           verbose logging
</code></pre><h3 id="example">Example</h3>
<p>ä»¥å®˜æ–¹ç»™çš„ä¾‹å­ main.go</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">A</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">B</span>
	<span style="color:#a6e22e">C</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">D</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">B</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">E</span>, <span style="color:#a6e22e">F</span>  <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">G</span>     <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Timer</span> <span style="color:#a6e22e">H</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">D</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">I</span> <span style="color:#66d9ef">uint64</span>
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">H</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Timer</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Ticker</span>
	<span style="color:#a6e22e">J</span>     <span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">D</span>
}

</code></pre></div><p><strong>ç”Ÿæˆç»“æ„å…³ç³»ï¼š</strong></p>
<pre tabindex="0"><code>&gt; embedded-struct-visualizer
digraph {
&quot;main.A&quot; -&gt; { &quot;main.B&quot; &quot;main.D&quot; };
&quot;main.B&quot; -&gt; { &quot;main.H&quot; };
&quot;main.H&quot; -&gt; { &quot;time.Ticker&quot; &quot;main.D&quot; };
}

</code></pre><p><strong>ç”Ÿæˆç»“æ„å…³ç³» å¹¶ è¾“å‡ºåˆ°.gv æ–‡ä»¶ï¼š</strong></p>
<pre tabindex="0"><code>&gt;embedded-struct-visualizer -out .\example.gv
&gt; ls

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        2022/11/27     10:54            112 example.gv
-a----        2022/11/26     22:06             31 go.mod
-a----        2022/11/26     22:07            208 main.go

</code></pre><p>é¡¹ç›®ç›®å½•ä¸‹å¤šå‡ºäº†example.gv ,å…·ä½“å†…å®¹å¦‚ä¸‹</p>
<pre tabindex="0"><code>cat .\example.gv
digraph {
&quot;main.A&quot; -&gt; { &quot;main.B&quot; &quot;main.D&quot; };
&quot;main.B&quot; -&gt; { &quot;main.H&quot; };
&quot;main.H&quot; -&gt; { &quot;time.Ticker&quot; &quot;main.D&quot; };
</code></pre><h3 id="å®‰è£…-graphviz">å®‰è£… graphvizÂ </h3>
<blockquote>
<p>graphviz æ˜¯ä¸€ç§å°†ç»“æ„ä¿¡æ¯è¡¨ç¤ºä¸ºæŠ½è±¡å›¾å’Œç½‘ç»œçš„å›¾çš„å·¥å…·ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼ŒæŠŠç”Ÿæˆçš„gvæ–‡ä»¶åˆ©ç”¨graphvizç»˜åˆ¶çš„æ›´ç¾è§‚ã€‚</p>
<p>é¦–å…ˆä¸‹è½½å®‰è£…:</p>
<blockquote>
<p><a href="https://graphviz.org/download/">https://graphviz.org/download/</a>
æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼ˆWinï¼‰ï¼š</p>
</blockquote>
<pre tabindex="0"><code> dot -v
dot - graphviz version 7.0.2 (20221119.0110)
... &lt;ä¸ºäº†ä¸ç¯‡å¹…è¿‡é•¿ï¼Œçœç•¥ä¸€äº›ç»†èŠ‚&gt;
</code></pre><h3 id="åˆ©ç”¨graphvizç»˜å›¾">åˆ©ç”¨graphvizç»˜å›¾</h3>
<blockquote>
<p>dot  -Tformat[:renderer[:formatter]] -o 
å°†è¾“å‡ºè¯­è¨€è®¾ç½®ä¸ºæ”¯æŒçš„æ ¼å¼ä¹‹ä¸€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆå¸¦å±æ€§çš„ç‚¹ã€‚</p>
</blockquote>
<p>æ¥ç€æŠŠä¸Šä¸€æ­¥ç”Ÿæˆçš„gvæ–‡ä»¶ï¼Œç”ŸæˆPNGè¾“å‡º</p>
<pre tabindex="0"><code>dot -Tpng example.gv -o example.png
</code></pre><p>åœ¨é¡¹ç›®ç›®å½•ä¸‹å¤šå‡ºexample.png
<img src="https://luckytking.github.io/images/embedded-struct-visualizer1.png" alt=""></p>
<p>æ¥ç€ï¼Œå®ç”¨äºä¸€ä¸ªç›¸å¯¹å¤æ‚çš„Gin Engineçš„gv</p>
<ol>
<li>
<p>æºç é“¾æ¥ï¼š <a href="https://github.com/gin-gonic/gin/blob/master/gin.go">https://github.com/gin-gonic/gin/blob/master/gin.go</a></p>
</li>
<li>
<p>ç”Ÿæˆçš„gvï¼š</p>
</li>
</ol>
<pre tabindex="0"><code>embedded-struct-visualizer -out .\gin.gv
</code></pre><p>gin.gv è¯¦ç»†å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code class="language-gin.gv" data-lang="gin.gv">digraph {&quot;gin.mockWriter&quot; -&gt; { &quot;http.Header&quot; };&quot;binding.QueryTest&quot; -&gt; { &quot;binding.appkey&quot; };&quot;binding.FooBarStruct&quot; -&gt; { &quot;binding.FooStruct&quot; };&quot;binding.FooBarFileStruct&quot; -&gt; { &quot;binding.FooBarStruct&quot; 
&quot;multipart.FileHeader&quot; };&quot;binding.FooBarFileFailStruct&quot; -&gt; { &quot;binding.FooBarStruct&quot; 
&quot;multipart.FileHeader&quot; };&quot;binding.FooDefaultBarStruct&quot; -&gt; { &quot;binding.FooStruct&quot; };&quot;binding.FooStructUseNumber&quot; -&gt; { &quot;binding.any&quot; };&quot;binding.FooStructDisallowUnknownFields&quot; -&gt; { &quot;binding.any&quot; 
};&quot;binding.FooBarStructForTimeType&quot; -&gt; { &quot;time.Time&quot; };&quot;binding.FooStructForTimeTypeNotUnixFormat&quot; -&gt; { &quot;time.Time&quot; 
};&quot;binding.FooStructForTimeTypeNotFormat&quot; -&gt; { &quot;time.Time&quot; };&quot;binding.FooStructForTimeTypeFailFormat&quot; -&gt; { &quot;time.Time&quot; };&quot;binding.FooStructForTimeTypeFailLocation&quot; -&gt; { &quot;time.Time&quot; 
};&quot;binding.FooStructForMapType&quot; -&gt; { &quot;binding.any&quot; };&quot;binding.FooStructForIgnoreFormTag&quot; -&gt; { &quot;binding.string&quot; };&quot;binding.defaultValidator&quot; -&gt; { &quot;sync.Once&quot; 
&quot;validator.Validate&quot; };&quot;binding.structFull&quot; -&gt; { &quot;binding.&quot; &quot;time.Time&quot; 
&quot;binding.string&quot; };&quot;binding.S&quot; -&gt; { &quot;binding.S&quot; };&quot;binding.testFile&quot; -&gt; { &quot;binding.byte&quot; };&quot;binding.structNoValidationValues&quot; -&gt; { 
&quot;binding.substructNoValidation&quot; &quot;binding.int16&quot; 
&quot;binding.uint16&quot; &quot;time.Time&quot; &quot;binding.mapNoValidationSub&quot; 
&quot;binding.&quot; };&quot;binding.structNoValidationPointer&quot; -&gt; { 
&quot;binding.substructNoValidation&quot; &quot;binding.uint32&quot; 
&quot;binding.mapNoValidationSub&quot; &quot;binding.int8&quot; &quot;binding.int32&quot; 
&quot;binding.uint8&quot; &quot;binding.uint16&quot; &quot;binding.float64&quot; 
&quot;binding.map&quot; &quot;binding.int&quot; &quot;binding.int16&quot; &quot;binding.int64&quot; 
&quot;binding.float32&quot; &quot;time.Time&quot; &quot;binding.testInterface&quot; 
&quot;binding.uint&quot; &quot;binding.uint64&quot; &quot;binding.string&quot; };&quot;gin.Context&quot; -&gt; { &quot;url.Values&quot; &quot;gin.responseWriter&quot; 
&quot;gin.HandlersChain&quot; &quot;gin.any&quot; &quot;gin.errorMsgs&quot; 
&quot;gin.skippedNode&quot; &quot;sync.RWMutex&quot; &quot;gin.string&quot; 
&quot;http.SameSite&quot; &quot;http.Request&quot; &quot;gin.ResponseWriter&quot; 
&quot;gin.Params&quot; &quot;gin.Engine&quot; };&quot;gin.interceptedWriter&quot; -&gt; { &quot;gin.ResponseWriter&quot; 
&quot;bytes.Buffer&quot; };&quot;gin.Error&quot; -&gt; { &quot;gin.error&quot; &quot;gin.ErrorType&quot; &quot;gin.any&quot; };&quot;gin.onlyFilesFS&quot; -&gt; { &quot;http.FileSystem&quot; };&quot;gin.neuteredReaddirFile&quot; -&gt; { &quot;http.File&quot; };&quot;gin.RouteInfo&quot; -&gt; { &quot;gin.HandlerFunc&quot; };&quot;gin.Engine&quot; -&gt; { &quot;gin.RouterGroup&quot; &quot;gin.string&quot; 
&quot;render.HTMLRender&quot; &quot;gin.HandlersChain&quot; &quot;sync.Pool&quot; 
&quot;gin.methodTrees&quot; &quot;render.Delims&quot; &quot;template.FuncMap&quot; 
&quot;gin.uint16&quot; &quot;net.IPNet&quot; };&quot;gin.LoggerConfig&quot; -&gt; { &quot;gin.LogFormatter&quot; &quot;io.Writer&quot; 
&quot;gin.string&quot; };&quot;gin.LogFormatterParams&quot; -&gt; { &quot;http.Request&quot; &quot;time.Time&quot; 
&quot;time.Duration&quot; &quot;gin.any&quot; };&quot;render.Data&quot; -&gt; { &quot;render.byte&quot; };&quot;render.HTMLProduction&quot; -&gt; { &quot;template.Template&quot; 
&quot;render.Delims&quot; };&quot;render.HTMLDebug&quot; -&gt; { &quot;render.string&quot; &quot;render.Delims&quot; 
&quot;template.FuncMap&quot; };&quot;render.HTML&quot; -&gt; { &quot;template.Template&quot; &quot;render.any&quot; };&quot;render.JSON&quot; -&gt; { &quot;render.any&quot; };&quot;render.IndentedJSON&quot; -&gt; { &quot;render.any&quot; };&quot;render.SecureJSON&quot; -&gt; { &quot;render.any&quot; };&quot;render.JsonpJSON&quot; -&gt; { &quot;render.any&quot; };&quot;render.AsciiJSON&quot; -&gt; { &quot;render.any&quot; };&quot;render.PureJSON&quot; -&gt; { &quot;render.any&quot; };&quot;render.MsgPack&quot; -&gt; { &quot;render.any&quot; };&quot;render.ProtoBuf&quot; -&gt; { &quot;render.any&quot; };&quot;render.Reader&quot; -&gt; { &quot;io.Reader&quot; };&quot;render.Redirect&quot; -&gt; { &quot;http.Request&quot; };&quot;render.String&quot; -&gt; { &quot;render.any&quot; };&quot;render.TOML&quot; -&gt; { &quot;render.any&quot; };&quot;render.XML&quot; -&gt; { &quot;render.any&quot; };&quot;render.YAML&quot; -&gt; { &quot;render.any&quot; };&quot;gin.responseWriter&quot; -&gt; { &quot;http.ResponseWriter&quot; };&quot;gin.RouterGroup&quot; -&gt; { &quot;gin.HandlersChain&quot; &quot;gin.Engine&quot; };&quot;protoexample.Test&quot; -&gt; { &quot;protoexample.int32&quot; 
&quot;protoexample.int64&quot; &quot;protoexample.TestOptionalGroup&quot; 
&quot;protoimpl.MessageState&quot; &quot;protoimpl.SizeCache&quot; 
&quot;protoimpl.UnknownFields&quot; &quot;protoexample.string&quot; };&quot;protoexample.Test_OptionalGroup&quot; -&gt; { 
&quot;protoimpl.MessageState&quot; &quot;protoimpl.SizeCache&quot; 
&quot;protoimpl.UnknownFields&quot; &quot;protoexample.string&quot; };&quot;gin.methodTree&quot; -&gt; { &quot;gin.node&quot; };&quot;gin.node&quot; -&gt; { &quot;gin.node&quot; &quot;gin.HandlersChain&quot; 
&quot;gin.nodeType&quot; };&quot;gin.nodeValue&quot; -&gt; { &quot;gin.HandlersChain&quot; &quot;gin.Params&quot; };&quot;gin.skippedNode&quot; -&gt; { &quot;gin.node&quot; &quot;gin.int16&quot; };}


</code></pre><ol start="3">
<li>ç»˜åˆ¶png</li>
</ol>
<pre tabindex="0"><code> dot -Tpng gin.gv -o gin.png
</code></pre><p><img src="https://luckytking.github.io/images/embedded-struct-visualizer-gin.png" alt="">
&lt;psï¼š å›¾ç‰‡è¿‡å¤§å¯ä¸‹è½½é¢„è§ˆ&gt;</p>
<ul>
<li>graphviz guideä¼˜åŒ–: <a href="https://www.graphviz.org/pdf/dotguide.pdf">https://www.graphviz.org/pdf/dotguide.pdf</a></li>
</ul>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li><a href="https://github.com/davidschlachter/embedded-struct-visualizer">https://github.com/davidschlachter/embedded-struct-visualizer</a></li>
<li><a href="https://mp.weixin.qq.com/s/VGotQkmlnqFDNhmKuEBhwg">https://mp.weixin.qq.com/s/VGotQkmlnqFDNhmKuEBhwg</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2022/11/go%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7-%E7%BB%98%E5%88%B6%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84%E5%92%8C%E4%BE%9D%E8%B5%96/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/11/ingress%E4%B8%8Eingresscontroller/" aria-label="">
      
          Ingressä¸IngressController
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-11-20T15:31:51&#43;08:00">
        
   20, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/k8s">k8s</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>æœ¬æ–‡ä¸»è¦å­¦ä¹ è®°å½•Kubernetesé›†ç¾¤æš´éœ²æœåŠ¡çš„æ–¹å¼: Ingressã€‚</p>
<h3 id="ç®€ä»‹">ç®€ä»‹</h3>
<blockquote>
<p>Ingress æ˜¯å¯¹é›†ç¾¤ä¸­æœåŠ¡çš„å¤–éƒ¨è®¿é—®è¿›è¡Œç®¡ç†çš„ API å¯¹è±¡ï¼Œå…¸å‹çš„è®¿é—®æ–¹å¼æ˜¯ HTTPã€‚Ingress å¯ä»¥æä¾›è´Ÿè½½å‡è¡¡ã€SSL ç»ˆç»“å’ŒåŸºäºåç§°çš„è™šæ‹Ÿæ‰˜ç®¡ã€‚</p>
<p>IngressController  ä¸ºäº†è®© Ingress èµ„æºå·¥ä½œï¼Œé›†ç¾¤å¿…é¡»æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Ingress æ§åˆ¶å™¨ã€‚</p>
</blockquote>
<p><img src="https://luckytking.github.io/images/ingress_layout.png" alt=""></p>
<p>ä¸Šå›¾æ¸…æ™°æ ‡è¯†å‡ºäº†Ingressçš„æµé‡èµ°å‘ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>IngressåŸºäºDNSåç§°ï¼ˆhostï¼‰æˆ–URLè·¯å¾„æŠŠè¯·æ±‚è½¬å‘â¾„æŒ‡å®šçš„Serviceèµ„æºçš„è§„åˆ™ã€‚å®ƒä»…æ˜¯â¼€ç»„è·¯ç”±è§„åˆ™çš„é›†åˆã€‚</li>
<li>Ingressæ§åˆ¶å™¨æ˜¯çœŸæ­£å®ç°â€œæµé‡ç©¿é€â€ï¼Œå¯ä»¥ç”±å…·æœ‰åå‘ä»£ç†ï¼ˆHTTP/HTTPSï¼‰åŠŸèƒ½çš„æœåŠ¡ç¨‹åºå®ç° , ç„¶åæ ¹æ®è¿™äº›è§„åˆ™çš„åŒ¹é…æœºåˆ¶è·¯ç”±è¯·æ±‚æµé‡</li>
</ul>
<h3 id="ingress-èµ„æºå£°æ˜">Ingress èµ„æºå£°æ˜</h3>
<p>Ingressæ˜¯Kubernetes APIçš„æ ‡å‡†èµ„æºç±»å‹ä¹‹â¼€ ,ä¸€ä¸ªæœ€å°Ingressä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">networking.k8s.io/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">minimal-ingress</span>
  <span style="color:#f92672">annotations</span>:
    <span style="color:#f92672">nginx.ingress.kubernetes.io/rewrite-target</span>: <span style="color:#ae81ff">/</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">ingressClassName</span>: <span style="color:#ae81ff">nginx-example</span>
  <span style="color:#f92672">rules</span>:
  - <span style="color:#f92672">http</span>:
      <span style="color:#f92672">paths</span>:
      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/testpath</span>
        <span style="color:#f92672">pathType</span>: <span style="color:#ae81ff">Prefix</span>
        <span style="color:#f92672">backend</span>:
          <span style="color:#f92672">service</span>:
            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">test</span>
            <span style="color:#f92672">port</span>:
              <span style="color:#f92672">number</span>: <span style="color:#ae81ff">80</span>
</code></pre></div><p>å…¶ä¸­:</p>
<ul>
<li>Ingress éœ€è¦æŒ‡å®šÂ apiVersionã€kindã€Â metadataå’ŒÂ specÂ å­—æ®µã€‚</li>
<li>Ingress å¯¹è±¡çš„å‘½åå¿…é¡»æ˜¯åˆæ³•çš„Â DNS å­åŸŸååç§°ã€‚</li>
<li>Ingress annotations æ¥é…ç½®ä¸€äº›é€‰é¡¹,  â½¤äºè¯†åˆ«å…¶æ‰€å±çš„Ingressæ§åˆ¶å™¨çš„ç±»åˆ«ã€‚</li>
<li>IngressÂ rulesÂ æä¾›äº†é…ç½®è´Ÿè½½å‡è¡¡å™¨æˆ–è€…ä»£ç†æœåŠ¡å™¨æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ æœ€é‡è¦çš„æ˜¯ï¼Œå…¶ä¸­åŒ…å«ä¸æ‰€æœ‰ä¼ å…¥è¯·æ±‚åŒ¹é…çš„è§„åˆ™åˆ—è¡¨ã€‚ Ingress èµ„æºä»…æ”¯æŒç”¨äºè½¬å‘ HTTP(S) æµé‡çš„è§„åˆ™ã€‚</li>
</ul>
<p>æ›´å¤šå‚è€ƒï¼š <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/">https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/</a></p>
<h3 id="ingress-controller">Ingress Controller</h3>
<p>Ingressæ§åˆ¶å™¨å¯ä»¥ç”±ä»»ä½•å…·æœ‰åå‘ä»£ç†ï¼ˆHTTP/HTTPSï¼‰åŠŸèƒ½çš„æœåŠ¡ç¨‹åºå®ç°ï¼Œç›®å‰æ”¯æŒå’Œç»´æŠ¤Â AWSã€Â GCEÂ å’ŒÂ NginxÂ Ingress æ§åˆ¶å™¨ã€‚</p>
<ul>
<li>NginxÂ Ingress ä½œä¸ºåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ã€‚</li>
<li>Apache APISIX Ingress æ§åˆ¶å™¨Â æ˜¯ä¸€ä¸ªåŸºäºÂ Apache APISIX ç½‘å…³Â çš„ Ingress æ§åˆ¶å™¨ã€‚</li>
</ul>
<p>æ›´å¤šå‚è€ƒï¼šhttps://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/</p>
<h3 id="å®‰è£…-ingress-nginx">å®‰è£… Ingress Nginx</h3>
<pre tabindex="0"><code>wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.0.0/deploy/static/provider/cloud/deploy.yaml  -O ingress-nginx-deploy.yaml

kubectl apply -f  ingress-nginx-deploy.yaml
</code></pre><p>è§‚æµ‹æ˜¯å¦æˆåŠŸï¼š</p>
<pre tabindex="0"><code>kubectl get pods -n ingress-nginx --watch
</code></pre><p>å¦‚æœæˆåŠŸçš„è¯ï¼ŒæŸ¥çœ‹namespaceä¸‹æ‰€æœ‰çš„èµ„æºä¿¡æ¯</p>
<pre tabindex="0"><code>root@master:/home/master# kubectl get all -n ingress-nginx
NAME                                            READY   STATUS    RESTARTS   AGE
pod/ingress-nginx-controller-123456   1/1     Running   0          1h

NAME                                         TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)                      AGE
service/ingress-nginx-controller             LoadBalancer   10.104.182.98    192.168.1.100   80:31666/TCP,443:31888/TCP   1d
service/ingress-nginx-controller-admission   ClusterIP      10.111.228.99   &lt;none&gt;         443/TCP                      1d

NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/ingress-nginx-controller   1/1     1            1           1d

NAME                                                  DESIRED   CURRENT   READY   AGE
replicaset.apps/ingress-nginx-controller-123456   1         1         1      1d

NAME                                       COMPLETIONS   DURATION   AGE
job.batch/ingress-nginx-admission-create   1/1           1s         1d
job.batch/ingress-nginx-admission-patch    1/1           2s         1d
</code></pre><h3 id="ä½¿ç”¨ingress-å‘å¸ƒ-tomcat">ä½¿ç”¨Ingress å‘å¸ƒ Tomcat</h3>
<p>éƒ¨ç½²Tomcat Service</p>
<ol>
<li>
<p>åˆ›å»ºdeployment</p>
<pre tabindex="0"><code>    kubectl create deployment web --image=tomcat:8.0.50-jre8-alpine
</code></pre></li>
<li>
<p>å°† Deployment æš´éœ²å‡ºæ¥</p>
<pre tabindex="0"><code>kubectl expose deployment web --type=NodePort --port=8080

</code></pre></li>
<li>
<p>å°† Deployment æš´éœ²å‡ºæ¥</p>
<pre tabindex="0"><code>root@master:/home/master# kubectl get service web
    NAME   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
    web    NodePort   10.100.183.22   &lt;none&gt;        8080:32562/TCP   30s
</code></pre></li>
<li>
<p>éªŒè¯nodeport æ˜¯å¦æ­£å¸¸è®¿é—® tomcat ï¼Œæµè§ˆå™¨è®¿é—®  http://matster_ip:32562
<img src="https://luckytking.github.io/images/ingress_tomcat.png" alt=""></p>
</li>
<li>
<p>åˆ›å»º ingress</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"> <span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">networking.k8s.io/v1</span>
    <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ingressfoo</span>
      <span style="color:#f92672">annotations</span>:
        <span style="color:#f92672">kubernetes.io/ingress.class</span>: <span style="color:#e6db74">&#34;nginx&#34;</span>
      <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">default</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">rules</span>:
      - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">ingressfoo.io</span>
        <span style="color:#f92672">http</span>:
          <span style="color:#f92672">paths</span>:
          - <span style="color:#f92672">backend</span>:
              <span style="color:#f92672">service</span>:
                <span style="color:#f92672">name</span>: <span style="color:#ae81ff">web</span>
                <span style="color:#f92672">port</span>:
                  <span style="color:#f92672">number</span>: <span style="color:#ae81ff">8080</span>
            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/bar</span>
            <span style="color:#f92672">pathType</span>: <span style="color:#ae81ff">Prefix</span>
</code></pre></div><p>æŸ¥çœ‹ingressæ˜¯å¦åˆ›å»ºæˆåŠŸ</p>
<pre tabindex="0"><code>root@master:/home/master# kubectl get ingress
NAME         CLASS    HOSTS                     ADDRESS        PORTS   AGE
ingressfoo   &lt;none&gt;   ingressfoo.io   192.168.1.100   80      1h
</code></pre><p>è¯´æ˜Ingressåˆ›å»ºæˆåŠŸï¼Œä¿®æ”¹hosts ï¼š</p>
<blockquote>
<p>ingressfoo.io 192.168.1.100</p>
</blockquote>
<p>éªŒè¯è®¿é—® ingressfoo.io/bar</p>
<p><img src="https://luckytking.github.io/images/ingress_tomcat2.png" alt=""></p>
<p>success</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li>Ingress  ä»‹ç» <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/">https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress/</a></li>
<li>IngressController ä»‹ç»  <a href="https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/">https://kubernetes.io/zh-cn/docs/concepts/services-networking/ingress-controllers/</a></li>
<li><a href="https://github.com/apache/apisix-ingress-controller">https://github.com/apache/apisix-ingress-controller</a></li>
<li>NGINX Ingress æ§åˆ¶å™¨é…ç½® Ingress <a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%90%AF%E7%94%A8-ingress-%E6%8E%A7%E5%88%B6%E5%99%A8">https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/ingress-minikube/#%E5%90%AF%E7%94%A8-ingress-%E6%8E%A7%E5%88%B6%E5%99%A8</a></li>
<li>åœ¨K8Sä¸Šçš„WebæœåŠ¡è¯¥æ€ä¹ˆåšåŸŸåè§£æ <a href="https://mp.weixin.qq.com/s/ZU61NIMxh_UOo-chNvkPXA">https://mp.weixin.qq.com/s/ZU61NIMxh_UOo-chNvkPXA</a></li>
<li>ã€ŠKubernetesè¿›é˜¶å®æˆ˜-ç¬¬2ç‰ˆã€‹Â Â https://item.jd.com/13140598.html</li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2022/11/ingress%E4%B8%8Eingresscontroller/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/11/go%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%BC%95%E6%B5%81%E5%B7%A5%E5%85%B7goreplay/" aria-label="">
      
          Goç½‘ç»œæŠ“åŒ…ã€å¼•æµå·¥å…·GoReplay
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-11-12T22:57:15&#43;08:00">
        
   12, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/%e8%bd%af%e4%bb%b6%e6%b5%8b%e8%af%95">è½¯ä»¶æµ‹è¯•</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <p>æœ¬æ–‡ç®€è¦ä»‹ç»Goç½‘ç»œæŠ“åŒ…ã€å¼•æµå·¥å…·GoReplayã€‚</p>
<h3 id="å‰è¨€">å‰è¨€</h3>
<p>åœ¨åç«¯çš„å®é™…å¼€å‘ä¸­ï¼Œä¼šé‡åˆ°ä»¥ä¸‹ä¸€äº›åœºæ™¯ï¼š</p>
<ul>
<li>ç”¨æˆ·é€šè¿‡ä½œå¼Šæ‰‹æ®µç»•è¿‡å‰ç«¯ï¼Œåˆ©ç”¨æŠ“åŒ…ï¼Œè¿›è¡Œç ´è§£ï¼Œæ¨¡æ‹Ÿï¼Œé­”æ”¹äº¤äº’æ•°æ®è¿›è¡Œä¼ªè£…ã€‚åç«¯ç¨‹åºéœ€è¦å¯¹å…¶æ“ä½œè®°å½•è¿›è¡Œé‡ç°å’Œè·Ÿè¸ªã€‚</li>
<li>æŸä¸ªbugåœ¨æµ‹è¯•ç¯å¢ƒæ— æ³•å¤ç°ã€‚</li>
<li>æœåŠ¡å‹æµ‹æ•°æ®å’Œçº¿ä¸Šæ•°æ®æœ‰åå·®ï¼Œå‹æµ‹æ•°æ®å¸Œæœ›èƒ½å’Œçº¿ä¸Šæ¥è¿‘ ã€‚</li>
</ul>
<p>GoReplayæ˜¯Goè¯­è¨€ç¼–å†™çš„æµé‡å›æ”¾å·¥å…·ï¼Œä¾¦å¬å™¨æœåŠ¡å™¨æ•è·httpæµé‡å¹¶å°†å…¶å‘é€åˆ°é‡æ”¾æœåŠ¡å™¨æˆ–ä¿å­˜åˆ°æ–‡ä»¶ã€‚é‡æ’­æœåŠ¡å™¨å°†æµé‡è½¬å‘ç»™ç»™å®šçš„åœ°å€ã€‚</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>æµ‹è¯•ç¯å¢ƒï¼š Windowsã€‚
ç‰ˆæœ¬ï¼š Version:1.3.0
å®‰è£…åˆ†2æ­¥éª¤ï¼š</p>
<ol>
<li>å‰ç½®æ¡ä»¶ï¼š å®‰è£…npcap 
<a href="https://npcap.com">https://npcap.com</a></li>
</ol>
<blockquote>
<p>GoReplayå¯ä»¥åœ¨Windowsæœºå™¨ä¸Šå·¥ä½œï¼Œä½†ç”±äºWindowså †æ ˆçš„ä¸åŒç½‘ç»œå±‚çš„æ€§è´¨ï¼Œå®ƒæœ‰ä¸€äº›ç»†èŠ‚ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼ŒWindowsä¸åƒUnixç³»ç»Ÿé‚£æ ·æœ‰æ”¯æŒåŒ…æ•è·çš„ç½‘ç»œé©±åŠ¨ç¨‹åºï¼Œå¦‚æœæ‚¨æƒ³æ•è·é€šä¿¡é‡ï¼Œåˆ™å¿…é¡»å•ç‹¬å®‰è£…å®ƒã€‚å…¶ä¸­ä¸€ä¸ªé€‰é¡¹æ˜¯å®‰è£…https://nmap.org/npcap/ã€‚</p>
</blockquote>
<ol start="2">
<li>å®‰è£…ï¼šè¿™é‡Œæµ‹è¯•ä½¿ç”¨çš„æ˜¯ gor-1.3.3_windows.zip
<a href="https://github.com/buger/goreplay/releases">https://github.com/buger/goreplay/releases</a> 
ä¸‹è½½è§£å‹å³å¯ã€‚</li>
</ol>
<h3 id="æ•è·æµé‡">æ•è·æµé‡</h3>
<blockquote>
<p>å¯åŠ¨ä¸¤ä¸ªhttpæœåŠ¡ï¼š</p>
</blockquote>
<ol>
<li>httpServerA: http://localhost:8000 ç›‘å¬ç«¯å£8000</li>
<li>httpServerB: http://localhost:8001 ç›‘å¬ç«¯å£8001</li>
</ol>
<p>è·¯ç”±ä¸º â€œget: &ldquo;/helloworld/{name}&rdquo;</p>
<blockquote>
<p>ç›‘å¬ç«¯å£8000ï¼Œå¹¶è¾“å‡ºåˆ°stdout</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"> ./gor --input-raw <span style="color:#960050;background-color:#1e0010">:</span>8000 --output-stdout
</code></pre></div><blockquote>
<p>æ‰“å¼€æµè§ˆå™¨è¯·æ±‚æ¥å£ http://localhost:8000/helloworld/lilei</p>
</blockquote>
<blockquote>
<p>åœ¨gorçš„å‘½ä»¤è¡Œçª—å£ï¼š</p>
</blockquote>
<pre tabindex="0"><code>1 db0a1f4000000001c344a1d3 1668261985986369000 0
GET /helloworld/lilei HTTP/1.1
Host: localhost:8000
Connection: keep-alive
sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot; æ­¤å¤„çœç•¥ä¸€äº›ç³»æ•°
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: &quot;Windows&quot;
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: none
æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°
</code></pre><p>å¯è§ï¼Œgorå·²ç»æŠŠæ•´ä¸ªhttpè¯·æ±‚çš„å®Œæ•´ä¿¡æ¯è®°å½•ä¸‹æ¥ã€‚
åŒæ—¶gorè¿˜æ”¯æŒè¾“å‡ºåˆ°æ–‡ä»¶å’ŒElasticSearchï¼Œè¿›è¡Œå›æ”¾å’Œåˆ†æã€‚è®°å½•åˆ°æ–‡ä»¶request.gor</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"> ./gor --input-raw <span style="color:#960050;background-color:#1e0010">:</span>8000 --output<span style="color:#f92672">-file</span> request.gor --input-raw-track-response --input-raw-override-snaplen
</code></pre></div><blockquote>
<p>æ‰“å¼€æµè§ˆå™¨è¯·æ±‚æ¥å£ http://localhost:8000/helloworld/hanmeimei</p>
</blockquote>
<p>å†™å…¥åˆ°æ–‡ä»¶ request_0.gor</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Mode                 LastWriteTime         Length Name
----                 -------------         ------ ---- 
-a----        2022/11/12     21<span style="color:#960050;background-color:#1e0010">:</span>36           1876 request_0.gor
</code></pre></div><p>request_0 å†…å®¹å¦‚ä¸‹:</p>
<pre tabindex="0"><code class="language-gor" data-lang="gor">1 d4571f4000000001b7adc1a6 1668260139796335000 0
GET /helloworld/lilei HTTP/1.1
Host: localhost:8000
Connection: keep-alive
sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: &quot;Windows&quot;
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64), æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: none
æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°


ğŸµğŸ™ˆğŸ™‰
2 d4571f4000000001b7adc1a6 1668260139796652000 0
HTTP/1.1 200 OK
Content-Type: application/json
Date: Sat, 12 Nov 2022 13:35:39 GMT
Content-Length: 25

{&quot;message&quot;:&quot;Hello lilei&quot;}
ğŸµğŸ™ˆğŸ™‰
1 d4571f4000000001b7adc22b 1668260148757949000 0
GET /helloworld/hanmeimei HTTP/1.1
Host: localhost:8000
Connection: keep-alive
sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: &quot;Windows&quot;
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) , æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: none
æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°


ğŸµğŸ™ˆğŸ™‰
2 d4571f4000000001b7adc22b 1668260148758268000 0
æ­¤å¤„çœç•¥ä¸€äº›å‚æ•°

{&quot;message&quot;:&quot;Hello hanmeimei&quot;}
ğŸµğŸ™ˆğŸ™‰

</code></pre><h3 id="æµé‡å›æ”¾">æµé‡å›æ”¾</h3>
<p>æ¥ç€å°†è¯¥æ–‡ä»¶request_0.gor è¿›è¡Œæµé‡å›æ”¾ï¼Œå¹¶è½¬å‘åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨ï¼ˆHttpServerBï¼‰ä¸Šï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">./gor --input<span style="color:#f92672">-file</span> request_0.gor --output-http http<span style="color:#960050;background-color:#1e0010">:</span>//localhost<span style="color:#960050;background-color:#1e0010">:</span>8001
</code></pre></div><p>è§‚å¯ŸHttpServerBæœåŠ¡å™¨æ§åˆ¶å°è¾“å‡ºï¼š</p>
<pre tabindex="0"><code>INFO ts=2022-11-12T21:37:26+08:00 caller=greeter.go:44 service.id=LAPTOP-H3HBMV8A service.name= service.version= trace.id= span.id= msg=CreateGreeter: lilei
INFO ts=2022-11-12T21:37:34+08:00 caller=greeter.go:44 service.id=LAPTOP-H3HBMV8A service.name= service.version= trace.id= span.id= msg=CreateGreeter: hanmeimei

</code></pre><p>ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªè¯·æ±‚ï¼ˆhttp://localhost:8000/helloworld/ileiã€http://localhost:8000/helloworld/hanmeimeiï¼‰åˆ†åˆ«é‡æ”¾è¯·æ±‚åˆ°äº†HttpServerBã€‚</p>
<p>goræ”¯æŒè¿›è¡Œæµé‡ç¼©å°ã€æ”¾å¤§ã€å€é€Ÿé‡æ”¾ï¼Œå®ç°çœŸå®æµé‡çš„å‹æµ‹æ•ˆæœã€‚
æ›´å¤šå‘½ä»¤ ./gor -help æŸ¥çœ‹</p>
<h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li>å®˜æ–¹GitHub  <a href="https://github.com/buger/goreplay">https://github.com/buger/goreplay</a></li>
<li>å®‰è£…åŒ… <a href="https://github.com/buger/goreplay/releases">https://github.com/buger/goreplay/releases</a></li>
<li>Windows å®‰è£… <a href="https://github.com/buger/goreplay/wiki/Running-on-Windows">https://github.com/buger/goreplay/wiki/Running-on-Windows</a></li>
<li>å®˜æ–¹npcap <a href="https://npcap.com/">https://npcap.com/</a></li>
<li>Goreplayè¯¦è§£ <a href="https://www.cnblogs.com/sunsky303/p/9072871.html">https://www.cnblogs.com/sunsky303/p/9072871.html</a></li>
<li>å…¥é—¨å’Œå¯¼å…¥Es  <a href="https://mp.weixin.qq.com/s/mNjLiEBnHIZhOTrDwNkmvA">https://mp.weixin.qq.com/s/mNjLiEBnHIZhOTrDwNkmvA</a></li>
<li>ç®€ä»‹  <a href="https://www.jianshu.com/p/0f3bcfbf7874">https://www.jianshu.com/p/0f3bcfbf7874</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2022/11/go%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%BC%95%E6%B5%81%E5%B7%A5%E5%85%B7goreplay/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/11/kubernetes%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E4%B8%80%E6%9C%BA%E5%88%B6%E5%92%8C%E8%B5%84%E6%BA%90%E6%8C%87%E6%A0%87/" aria-label="">
      
          Kubernetesé›†ç¾¤èµ„æºç›‘æ§ä¸€æœºåˆ¶å’Œèµ„æºæŒ‡æ ‡
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-11-05T22:50:36&#43;08:00">
        
   5, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/k8s">k8s</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        æœ¬æ–‡ä¸»è¦ä»‹ç»Kubernetesé›†ç¾¤èµ„æºç›‘æ§æœºåˆ¶å’Œèµ„æºæŒ‡æ ‡
å‰è¨€ ä¸´è¿‘åŒ11ï¼Œå¯¹äºç å†œï¼Œå°¤å…¶æ˜¯åç«¯ï¼Œå°¤å…¶æ˜¯æŸå®æŸä¸œçš„åç«¯ï¼Œé‚£æ˜¯å¤šä¹ˆæ¿€åŠ¨äººå¿ƒï¼ˆå¿ƒæƒŠèƒ†æˆ˜ï¼‰çš„ä¸€å¤œï¼Œä¸ºä»€ä¹ˆï¼Ÿæ€•å®•æœºå‘€~ã€‚é‚£ä¹ˆå°±è®©æˆ‘ä»¬æ¥æ„å»ºæŠ¤åŸæ²³&ndash;ç›‘æ§ä¸è‡ªåŠ¨æ‰©å®¹ï¼Œæ¥æŠµæŒ¡åƒå†›ä¸‡é©¬&ndash;é«˜å¹¶å‘åœºæ™¯ã€‚é¦–å…ˆè®©æˆ‘ä»¬å­¦ä¹ ä¸€äº›åŸºç¡€ï¼šk8sé›†ç¾¤èµ„æºç›‘æ§æœºåˆ¶å’Œèµ„æºæŒ‡æ ‡ã€‚
åˆ†æ ä»éœ€æ±‚å‡ºå‘ï¼Œæˆ‘ä»¬è‡ªç„¶éœ€è¦æ”¶é›†ä¸€äº›æ•°æ®(èµ„æºæŒ‡æ ‡)ï¼Œå†æ ¹æ®æŒ‡æ ‡åšä¸€ç³»åˆ—çš„æ“ä½œ(control)ï¼Œæ¯”å¦‚è¯´é¢„è­¦è­¦å‘Šã€ç»Ÿè®¡ã€è‡ªåŠ¨æ‰©å®¹ç­‰ã€‚
é¦–å…ˆï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥ç›‘æ§æ•´ä¸ªKubernetesé›†ç¾¤çš„å¥åº·çŠ¶å†µï¼ŒåŒ…æ‹¬ï¼š
 æ•´ä¸ªé›†ç¾¤çš„èµ„æºåˆ©â½¤ç‡ é›†ç¾¤ä¸­çš„æ‰€æœ‰â¼¯ä½œèŠ‚ç‚¹æ˜¯å¦è¿â¾æ­£å¸¸ã€ç³»ç»Ÿèµ„æºå®¹é‡â¼¤â¼© æ¯ä¸ªâ¼¯ä½œèŠ‚ç‚¹ä¸Šè¿â¾çš„å®¹å™¨åŒ–åº”â½¤çš„æ•°é‡  k8sèµ„æºæ§åˆ¶ æˆ‘ä»¬çœ‹çœ‹k8så¦‚ä½•èµ„æºæ§åˆ¶
é™åˆ¶èŠ‚ç‚¹ ä»¥è´­ç‰©å¹³å°ä¸ºä¾‹ï¼Œå¾®æœåŠ¡å¹¿å—æ¨å´‡ï¼Œæ¯”å¦‚åŒ11å½“å¤©ï¼Œç”¨æˆ·è¿›é¦–é¡µæ˜¯æµç•…çš„ï¼Œä½†æ˜¯è¿›æ´»åŠ¨ä¸»é¡µå°±å¡é¡¿ï¼Œåˆ°äº†é›¶ç‚¹æ—¶ï¼ŒåŠ å…¥è´­ç‰©è½¦çš„æŒ‰é’®éƒ½è½¬åœˆäº†ã€‚è®¾æƒ³ä½ çš„è®¾è®¡å¯èƒ½æ˜¯ä¸‰ä¸ªå¾®æœåŠ¡ï¼ˆä¸»é¡µæœåŠ¡ ã€åŒåä¸€æ´»åŠ¨æœåŠ¡ã€è®¢å•æœåŠ¡ï¼‰ï¼Œå¯æƒ³è€ŒçŸ¥ï¼Œæ´»åŠ¨æœåŠ¡æ˜¯å‹åŠ›æœ€å¤§çš„ï¼Œæˆ‘ä»¬å¸Œæœ›ï¼Œå°±ç®—å®•æœºï¼Œä¸è¦å½±å“å…¶ä»–çš„æœåŠ¡ã€‚æ‰€ä»¥å¯ä»¥æŠŠæ´»åŠ¨æœåŠ¡é™åˆ¶è¿è¡Œåœ¨æŸèŠ‚ç‚¹ã€‚
 åˆ›å»ºä¸€ä¸ªä¼šè¢«è°ƒåº¦åˆ°ç‰¹å®šèŠ‚ç‚¹ä¸Šçš„ Podï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® nodeName å°†æŸä¸ª Pod è°ƒåº¦åˆ°ç‰¹å®šçš„èŠ‚ç‚¹
 nodeName: foo-node # è°ƒåº¦ Pod åˆ°ç‰¹å®šçš„èŠ‚ç‚¹ é™åˆ¶å†…å­˜ è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æŠŠæ´»åŠ¨æœåŠ¡è°ƒåº¦åˆ°äº† foo-nodeã€‚é‚£ä¹ˆå‰©ä¸‹çš„æœåŠ¡æ²¡æœ‰å»é™åˆ¶ï¼Œä½†æƒ³æƒ³è®¢å•æœåŠ¡çš„å‹åŠ›ä¹Ÿä¸å°ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›é™åˆ¶å®ƒçš„èµ„æºä¸Šé™ã€‚
 è¦ä¸ºå®¹å™¨æŒ‡å®šå†…å­˜è¯·æ±‚ï¼Œè¯·åœ¨å®¹å™¨èµ„æºæ¸…å•ä¸­åŒ…å«Â resourcesï¼šrequestsÂ å­—æ®µã€‚ åŒç†ï¼Œè¦æŒ‡å®šå†…å­˜é™åˆ¶ï¼Œè¯·åŒ…å«Â resourcesï¼šlimitsã€‚
 resources: requests: memory: &#34;1000Gi&#34; limits: memory: &#34;1000Gi&#34; é™åˆ¶CPU  è¦ä¸ºå®¹å™¨æŒ‡å®š CPU è¯·æ±‚ï¼Œè¯·åœ¨å®¹å™¨èµ„æºæ¸…å•ä¸­åŒ…å«Â resources: requestsÂ å­—æ®µã€‚ è¦æŒ‡å®š CPU é™åˆ¶ï¼Œè¯·åŒ…å«Â resources:limits
 resources: limits: cpu: &#34;100&#34; requests: cpu: &#34;100&#34; Example ç¯å¢ƒå‡†å¤‡:
 k8sé›†ç¾¤ï¼ˆmaster * 1ï¼Œnode * 2 ) kubectl å‘½ä»¤è¡Œå·¥å…·( ç¬”è€…ä½¿ç”¨rancher)   åˆ›å»ºä¸€ä¸ªnamespaceï¼ˆstressï¼‰ã€‚ å¢åŠ ä¸€ä¸ªdeployment, ä¿®æ”¹å†…å­˜ä¸Šé™ä¸º10M 1.
      
      <p>
        
          <a href="https://luckytking.github.io/2022/11/kubernetes%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E4%B8%80%E6%9C%BA%E5%88%B6%E5%92%8C%E8%B5%84%E6%BA%90%E6%8C%87%E6%A0%87/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
            
  
    
      
        
      
    
  


  

<article class="postShorten postShorten--thumbnailimg-right">
  <div class="postShorten-wrap">
    
    <div class="postShorten-header">
      <h1 class="postShorten-title">
      
        <a class="link-unstyled" href="https://luckytking.github.io/2022/10/golang%E4%BD%BF%E7%94%A8redissortsets%E5%AE%9E%E7%8E%B0%E6%8E%92%E8%A1%8C%E6%A6%9C/" aria-label="">
      
          Golangä½¿ç”¨RedisSortSetså®ç°æ’è¡Œæ¦œ
        </a>
      </h1>
      
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-10-30T15:43:28&#43;08:00">
        
   30, 2022

      </time>
    
    
  
  
    <span></span>
    
      <a class="category-link" href="https://luckytking.github.io/categories/go">go</a>
    
  

  </div>

    </div>
    <div class="postShorten-excerpt">
      
        <h3 id="å‰è¨€">å‰è¨€</h3>
<p>æ¸¸æˆæ’è¡Œæ¦œæ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œä»Šå¤©ä¸»è¦ä»‹ç»goè¯­è¨€ä½¿ç”¨redis-sort-setsæ¥å®ç°æ’è¡Œæ¦œå¸¸è§åŠŸèƒ½ã€‚</p>
<h3 id="redis-sort-sets">Redis Sort Sets</h3>
<p>å®˜æ–¹ä»‹ç»ï¼š</p>
<blockquote>
<p>Redisæ’åºé›†æ˜¯æŒ‰ç›¸å…³åˆ†æ•°æ’åºçš„æƒŸä¸€å­—ç¬¦ä¸²(æˆå‘˜)çš„é›†åˆã€‚å½“å¤šä¸ªå­—ç¬¦ä¸²å…·æœ‰ç›¸åŒçš„åˆ†æ•°æ—¶ï¼Œå­—ç¬¦ä¸²å°†æŒ‰å­—å…¸é¡ºåºæ’åˆ—ã€‚æ’åºé›†çš„ä¸€äº›ç”¨ä¾‹åŒ…æ‹¬:</p>
<p>æ¸¸æˆæ’è¡Œæ¦œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ’åºé›†è½»æ¾åœ°ç»´æŠ¤å¤§å‹åœ¨çº¿æ¸¸æˆä¸­æœ€é«˜åˆ†æ•°çš„æœ‰åºåˆ—è¡¨ã€‚
é€Ÿç‡é™åˆ¶å™¨ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ’åºé›†æ¥æ„å»ºæ»‘åŠ¨çª—å£é€Ÿç‡é™åˆ¶å™¨ï¼Œä»¥é˜²æ­¢è¿‡å¤šçš„APIè¯·æ±‚ã€‚</p>
</blockquote>
<p>å¸¸ç”¨äºæ’è¡Œæ¦œçš„å‘½ä»¤:</p>
<ul>
<li>ZRANGE è¿”å›æ’åºé›†çš„æˆå‘˜ï¼ˆå‡åºï¼‰</li>
<li>ZREVANGE è¿”å›æ’åºé›†çš„æˆå‘˜ï¼ˆé™åºåºï¼‰</li>
<li>ZADD å‘æ’åºé›†æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜å’Œç›¸å…³åˆ†æ•°ã€‚å¦‚æœæˆå‘˜å·²ç»å­˜åœ¨ï¼Œåˆ™æ›´æ–°è¯„åˆ†ã€‚</li>
<li>ZREM åˆ é™¤æ’åºé›†ä¸€ä¸ªæˆå‘˜</li>
<li>ZRANK è¿”å›æä¾›çš„æˆå‘˜çš„æ’å(å‡åº)</li>
<li>ZREVRANK è¿”å›æä¾›çš„æˆå‘˜çš„æ’å(é™åº)</li>
</ul>
<h3 id="go-redis">Go Redis</h3>
<p>Go Redisä¸ºå„ç§é£æ ¼çš„Redisæä¾›Goå®¢æˆ·ç«¯ï¼ŒåŸºç¡€çš„ä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;context&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/go-redis/redis/v9&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
	<span style="color:#a6e22e">rdb</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Options</span>{
		<span style="color:#a6e22e">Addr</span>:     <span style="color:#e6db74">&#34;localhost:6379&#34;</span>, <span style="color:#75715e">// use default Addr
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">Password</span>: <span style="color:#e6db74">&#34;&#34;</span>,               <span style="color:#75715e">// no password set
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">DB</span>:       <span style="color:#ae81ff">0</span>,                <span style="color:#75715e">// use default DB
</span><span style="color:#75715e"></span>	})
	<span style="color:#a6e22e">pong</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">Ping</span>(<span style="color:#a6e22e">ctx</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">pong</span>, <span style="color:#a6e22e">err</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">Close</span>()
}
</code></pre></div><h3 id="examples">Examples</h3>
<p>è¿™é‡Œæˆ‘ä»¬ç”¨go-rediså®ç°æ’è¡Œæ¦œå¸¸è§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬:</p>
<ul>
<li>è·å–æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•° ï¼ˆå‡åºã€é™åºï¼‰</li>
<li>åŠ å…¥æ’è¡Œæ¦œæˆå‘˜</li>
<li>åˆ é™¤æ’è¡Œæ¦œæˆå‘˜</li>
<li>æ›´æ–°æ’è¡Œæ¦œæˆå‘˜åˆ†æ•°</li>
<li>è·å–æ’è¡Œæ¦œæˆå‘˜åˆ†æ•°</li>
<li>è·å–æ’è¡Œæ¦œåæ¬¡æˆå‘˜</li>
<li>æ¸…ç©ºæ’è¡Œæ¦œ</li>
</ul>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;context&#34;</span>
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;github.com/go-redis/redis/v9&#34;</span>
	<span style="color:#e6db74">&#34;math/rand&#34;</span>
	<span style="color:#e6db74">&#34;strconv&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>()
	<span style="color:#a6e22e">rdb</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Options</span>{
		<span style="color:#a6e22e">Addr</span>:     <span style="color:#e6db74">&#34;localhost:6379&#34;</span>, <span style="color:#75715e">// use default Addr
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">Password</span>: <span style="color:#e6db74">&#34;&#34;</span>,               <span style="color:#75715e">// no password set
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">DB</span>:       <span style="color:#ae81ff">0</span>,                <span style="color:#75715e">// use default DB
</span><span style="color:#75715e"></span>	}) 
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">Close</span>()
	<span style="color:#75715e">//å¢åŠ ç©å®¶åˆ†æ•°çš„å˜åŒ–
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">5</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZAdd</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Z</span>{
			<span style="color:#a6e22e">Score</span>:  float64(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">100</span>)),
			<span style="color:#a6e22e">Member</span>: <span style="color:#e6db74">&#34;user:&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Itoa</span>(<span style="color:#a6e22e">i</span>),
		}).<span style="color:#a6e22e">Err</span>()
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
			<span style="color:#66d9ef">return</span>
		}
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#75715e">//æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">members</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRange</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº&#34;</span>, <span style="color:#a6e22e">members</span>)
	<span style="color:#75715e">//æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">membersWithScore</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRevRangeWithScores</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº&#34;</span>, <span style="color:#a6e22e">membersWithScore</span>)

	<span style="color:#75715e">//æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-é™åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">membersRev</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRevRange</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-é™åº&#34;</span>, <span style="color:#a6e22e">membersRev</span>)
	<span style="color:#75715e">//æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">membersRevWithScore</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRangeWithScores</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº&#34;</span>, <span style="color:#a6e22e">membersRevWithScore</span>)

	<span style="color:#75715e">//è·å–æŸç©å®¶çš„åˆ†æ•°
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">user2Score</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZScore</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#e6db74">&#34;user:2&#34;</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;è·å–æŸç©å®¶ user:2 çš„åˆ†æ•°&#34;</span>, <span style="color:#a6e22e">user2Score</span>)
	<span style="color:#75715e">//æ›´æ–°æŸç©å®¶çš„åˆ†æ•°
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZAdd</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#a6e22e">redis</span>.<span style="color:#a6e22e">Z</span>{
		<span style="color:#a6e22e">Score</span>:  <span style="color:#a6e22e">user2Score</span>,
		<span style="color:#a6e22e">Member</span>: <span style="color:#e6db74">&#34;user:1&#34;</span>,
	}).<span style="color:#a6e22e">Err</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æ›´æ–°æŸç©å®¶ user:1 çš„åˆ†æ•°&#34;</span>, <span style="color:#a6e22e">user2Score</span>)
	<span style="color:#75715e">//æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">membersRevWithScore</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRangeWithScores</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æŸ¥è¯¢æ’è¡Œæ¦œå˜åŒ–åçš„æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº&#34;</span>, <span style="color:#a6e22e">membersRevWithScore</span>)

	<span style="color:#75715e">//æŸ¥è¯¢æ’è¡Œæ¦œæŸç©å®¶çš„åˆ†æ•°-å‡åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">memberRank</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRank</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#e6db74">&#34;user:2&#34;</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æŸ¥è¯¢æ’è¡Œæ¦œæŸç©å®¶  user:2 çš„æ’å&#34;</span>, <span style="color:#a6e22e">memberRank</span>)

	<span style="color:#75715e">//æŸ¥è¯¢æ’è¡Œæ¦œæŸç©å®¶çš„åˆ†æ•°-é™åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">memberRevRank</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRevRank</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#e6db74">&#34;user:2&#34;</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æŸ¥è¯¢æ’è¡Œæ¦œæŸç©å®¶ user:2 çš„æ’å-é™åº&#34;</span>, <span style="color:#a6e22e">memberRevRank</span>)

	<span style="color:#75715e">//åˆ é™¤æ’åºé›†ä¸€ä¸ªæˆå‘˜
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">zrem</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRem</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#e6db74">&#34;user:1&#34;</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;åˆ é™¤æ’åºé›†ä¸€ä¸ªæˆå‘˜&#34;</span>, <span style="color:#a6e22e">zrem</span>)

	<span style="color:#75715e">//åˆ é™¤åæŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">members</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRange</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;åˆ é™¤åæŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº&#34;</span>, <span style="color:#a6e22e">members</span>)

	<span style="color:#75715e">//æ¸…ç©ºæ’è¡Œæ¦œ
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">clear</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRemRangeByRank</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;err zrem&#34;</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æ¸…ç©ºæ’è¡Œæ¦œ&#34;</span>, <span style="color:#a6e22e">clear</span>)
	<span style="color:#75715e">//æ¸…ç©ºåæŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">members</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">rdb</span>.<span style="color:#a6e22e">ZRange</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#e6db74">&#34;leaderboard&#34;</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Result</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;æ¸…ç©ºåæŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº&#34;</span>, <span style="color:#a6e22e">members</span>) 

</code></pre></div><p>OutPut:</p>
<pre tabindex="0"><code>æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº [user:3 user:4 user:1 user:5 user:2]
æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº [{87 user:2} {81 user:5} {81 user:1} {59 user:4} {47 user:3}]
æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-é™åº [user:2 user:5 user:1 user:4 user:3]
æŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº [{47 user:3} {59 user:4} {81 user:1} {81 user:5} {87 user:2}]
è·å–æŸç©å®¶ user:2 çš„åˆ†æ•° 87
æ›´æ–°æŸç©å®¶ user:1 çš„åˆ†æ•° 87
æŸ¥è¯¢æ’è¡Œæ¦œå˜åŒ–åçš„æ’è¡Œæ¦œæˆå‘˜å’Œåˆ†æ•°-å‡åº [{47 user:3} {59 user:4} {81 user:5} {87 user:1} {87 user:2}]
æŸ¥è¯¢æ’è¡Œæ¦œæŸç©å®¶  user:2 çš„æ’å 4
æŸ¥è¯¢æ’è¡Œæ¦œæŸç©å®¶ user:2 çš„æ’å-é™åº 0
åˆ é™¤æ’åºé›†ä¸€ä¸ªæˆå‘˜ 1
åˆ é™¤åæŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº [user:3 user:4 user:5 user:2]
æ¸…ç©ºæ’è¡Œæ¦œ 4
æ¸…ç©ºåæŸ¥è¯¢æ’è¡Œæ¦œæˆå‘˜-å‡åº []

</code></pre><h3 id="å‚è€ƒ">å‚è€ƒ</h3>
<ul>
<li>å®‰è£…Redis <a href="https://redis.io/docs/getting-started/installation/">https://redis.io/docs/getting-started/installation/</a></li>
<li>Redis Sort Sets Docs <a href="https://redis.io/docs/data-types/sorted-sets/">https://redis.io/docs/data-types/sorted-sets/</a></li>
<li>Go Redis <a href="https://github.com/go-redis/redis/v9">https://github.com/go-redis/redis/v9</a></li>
</ul>
      
      <p>
        
          <a href="https://luckytking.github.io/2022/10/golang%E4%BD%BF%E7%94%A8redissortsets%E5%AE%9E%E7%8E%B0%E6%8E%92%E8%A1%8C%E6%A6%9C/" class="postShorten-excerpt_link link" aria-label=""></a>
        
        
      </p>
    </div>
  </div>
  
</article>

          
          
  <div class="pagination-bar">
    <ul class="pagination">
      
        
          <li class="pagination-prev">
            <a class="btn btn--default btn--small" href="https://luckytking.github.io/page/2/" aria-label="">
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span></span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a class="btn btn--default btn--small" href="https://luckytking.github.io/page/4/" aria-label="">
              <span></span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
      
      <li class="pagination-number"> </li>
    </ul>
  </div>


        </section>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 jefffff. 
  </span>
</footer>

      </div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://luckytking.github.io/images/tk.jpg" alt="" />
    
    <h4 id="about-card-name">jefffff</h4>
    
      <div id="about-card-bio">Stay hungry. Stay Foolish  <strong>COOL</strong></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Go backend developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        China Amoy
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://luckytking.github.io/images/cover-v1.2.0.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://luckytking.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

